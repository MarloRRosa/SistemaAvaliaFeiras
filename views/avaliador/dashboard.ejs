<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title><%= titulo %></title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 font-sans leading-normal tracking-normal">

  <div class="container mx-auto p-4 mt-8">
    <h1 class="text-3xl font-bold mb-6 text-center">Dashboard do Avaliador</h1>

    <h2 class="text-xl font-semibold mb-4">Bem-vindo(a), <%= avaliador.nome %>!</h2>
    <p class="mb-6 text-gray-700">Aqui estão os projetos que você precisa avaliar.</p>

    <% if (error_msg && error_msg.length > 0) { %>
      <div class="bg-red-100 text-red-700 p-3 rounded mb-4">
        <%= error_msg[0] %>
      </div>
    <% } %>

    <% if (success_msg && success_msg.length > 0) { %>
      <div class="bg-green-100 text-green-700 p-3 rounded mb-4">
        <%= success_msg[0] %>
      </div>
    <% } %>

    <div class="space-y-4 mb-8">
      <% if (projetos && projetos.length > 0) { %>
        <% projetos.forEach(projeto => { %>
          <div class="bg-white p-6 rounded shadow-md border 
            <% if (projeto.statusAvaliacao === 'Avaliado') { %>border-green-400
            <% } else if (projeto.statusAvaliacao === 'Em Processo') { %>border-orange-400
            <% } else { %>border-yellow-400<% } %>">

            <h3 class="text-xl font-bold mb-2"><%= projeto.titulo %></h3>
            <p class="text-gray-700 mb-1"><strong>Turma:</strong> <%= projeto.turma %></p>
            <p class="text-gray-700 mb-1"><strong>Integrantes:</strong> <%= projeto.alunos %></p>
            <p class="text-gray-700 mb-1"><strong>Orientador:</strong> <%= projeto.orientador %></p>
            <% if (projeto.coorientador) { %>
              <p class="text-gray-700 mb-1"><strong>Coorientador:</strong> <%= projeto.coorientador %></p>
            <% } %>
            <p class="text-gray-700 mb-4"><strong>Descrição:</strong> <%= projeto.descricao %></p>

            <% if (projeto.relatorioPdf) { 
              const visualizadorGoogle = `https://docs.google.com/viewer?url=${encodeURIComponent(projeto.relatorioPdf)}&embedded=true`; %>
              <p class="mb-4">
                <strong class="text-gray-700">Relatório:</strong>
                <a href="<%= visualizadorGoogle %>" target="_blank" class="text-blue-600 hover:underline ml-1">
                  Ver Relatório PDF
                </a>
              </p>
            <% } else { %>
              <p class="mb-4 text-gray-400 italic">Sem relatório enviado</p>
            <% } %>

            <p class="font-semibold mb-4 text-sm <%= projeto.corStatus %>">
              Status: <%= projeto.statusAvaliacao %>
            </p>

            <% if (!avaliador.statusAvaliacaoGeral) { %>
              <a href="/avaliador/avaliar/<%= projeto._id %>" class="inline-block bg-blue-600 text-white py-2 px-4 rounded hover:bg-blue-700">
                <%= (projeto.statusAvaliacao === 'Pendente') ? 'Avaliar Projeto' : 'Ver / Editar Avaliação' %>
              </a>
            <% } else { %>
              <span class="inline-block bg-gray-400 text-white py-2 px-4 rounded cursor-not-allowed">
                Avaliação Finalizada
              </span>
            <% } %>

          </div>
        <% }); %>
      <% } else { %>
        <p class="text-center text-gray-600 p-4 bg-white rounded shadow-md">Nenhum projeto atribuído para avaliação no momento.</p>
      <% } %>
    </div>

    <% if (!avaliador.statusAvaliacaoGeral && projetos && projetos.length > 0) { %>
      <form action="/avaliador/finalizar-avaliacoes" method="POST" class="text-center mt-8">
        <button type="submit"
                class="py-3 px-6 rounded text-white font-bold
                       <% if (todosProjetosAvaliados) { %>
                         bg-green-600 hover:bg-green-700
                       <% } else { %>
                         bg-gray-400 cursor-not-allowed
                       <% } %>"
                <%= todosProjetosAvaliados ? '' : 'disabled' %>>
          Finalizar Todas as Avaliações
        </button>
      </form>
    <% } else if (avaliador.statusAvaliacaoGeral) { %>
      <p class="text-center mt-8 text-lg font-semibold text-green-700 p-4 bg-green-100 rounded">
        Suas avaliações foram finalizadas e seu PIN foi desativado.
      </p>
    <% } %>

    <div class="mt-8 text-center">
      <a href="/avaliador/agradecimento" class="text-purple-600 hover:underline">Sair do Dashboard</a>
    </div>
  </div>

</body>
</html>
