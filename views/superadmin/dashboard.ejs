<!--views/superadmin/dashboard.ejs-->
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= titulo %></title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        :root {
            --primary-color: #4f46e5;
            --primary-dark: #3730a3;
            --sidebar-width: 280px;
            --sidebar-collapsed-width: 72px;
        }

        * {
            scrollbar-width: thin;
            scrollbar-color: #d1d5db #f3f4f6;
        }

        *::-webkit-scrollbar {
            width: 6px;
        }

        *::-webkit-scrollbar-track {
            background: #f3f4f6;
        }

        *::-webkit-scrollbar-thumb {
            background-color: #d1d5db;
            border-radius: 20px;
        }

        .sidebar {
            width: var(--sidebar-width);
            transition: all 0.3s ease;
            background: linear-gradient(180deg, #1e293b 0%, #0f172a 100%);
            box-shadow: 4px 0 10px rgba(0, 0, 0, 0.1);
        }

        .sidebar.collapsed {
            width: var(--sidebar-collapsed-width);
        }

        .sidebar-item {
            @apply flex items-center gap-3 px-6 py-3 text-slate-300 hover:text-white hover:bg-slate-700/50 transition-all duration-200 cursor-pointer border-l-4 border-transparent;
        }

        .sidebar-item.active {
            @apply text-white bg-slate-700/70 border-l-indigo-500;
        }

        .sidebar-item:hover {
            transform: translateX(4px);
        }

        .sidebar.collapsed .sidebar-item {
            @apply px-6 justify-center;
        }

        .sidebar.collapsed .sidebar-item span {
            display: none;
        }

        .main-content {
            margin-left: var(--sidebar-width);
            transition: all 0.3s ease;
        }

        .main-content.expanded {
            margin-left: var(--sidebar-collapsed-width);
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .stat-card {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05));
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
        }

        .mobile-nav {
            display: none;
        }

        .mobile-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 40;
        }

        .mobile-overlay.active {
            display: block;
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.3s ease-in-out;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .modern-table {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        .modern-table th {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            font-weight: 600;
            color: #374151;
            padding: 1rem 1.5rem;
            text-transform: uppercase;
            font-size: 0.75rem;
            letter-spacing: 0.05em;
        }

        .modern-table td {
            padding: 1rem 1.5rem;
            border-bottom: 1px solid #f1f5f9;
        }

        .modern-table tbody tr:hover {
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
        }

        .action-btn {
            @apply inline-flex items-center justify-center w-8 h-8 rounded-full transition-all duration-200 hover:scale-110;
        }

        .action-btn.edit {
            @apply bg-blue-100 text-blue-600 hover:bg-blue-200;
        }

        .action-btn.toggle {
            @apply bg-yellow-100 text-yellow-600 hover:bg-yellow-200;
        }

        .action-btn.activate {
            @apply bg-green-100 text-green-600 hover:bg-green-200;
        }

        .action-btn.reset {
            @apply bg-red-100 text-red-600 hover:bg-red-200;
        }

        .floating-btn {
            @apply fixed bottom-6 right-6 w-14 h-14 bg-indigo-600 text-white rounded-full shadow-lg hover:bg-indigo-700 transition-all duration-200 hover:scale-110 flex items-center justify-center z-30;
        }

        @media (max-width: 768px) {
            .sidebar {
                position: fixed;
                left: -100%;
                top: 0;
                height: 100vh;
                z-index: 50;
                width: 280px;
            }

            .sidebar.mobile-open {
                left: 0;
            }

            .main-content {
                margin-left: 0;
            }

            .mobile-nav {
                display: flex;
            }

            .stat-card {
                margin-bottom: 1rem;
            }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-slate-50 to-slate-100 min-h-screen">
    <!-- Mobile Navigation -->
    <div class="mobile-nav fixed top-0 left-0 right-0 h-16 bg-white shadow-lg z-40 flex items-center justify-between px-4">
        <button id="mobile-menu-btn" class="p-2 rounded-lg hover:bg-gray-100">
            <i class="fas fa-bars text-xl text-gray-600"></i>
        </button>
        <h1 class="text-lg font-bold text-gray-800">Super Admin</h1>
        <a href="/superadmin/logout" class="p-2 rounded-lg hover:bg-red-50 text-red-600">
            <i class="fas fa-sign-out-alt"></i>
        </a>
    </div>

    <!-- Mobile Overlay -->
    <div class="mobile-overlay" id="mobile-overlay"></div>

    <!-- Sidebar -->
    <div class="sidebar fixed top-0 left-0 h-full z-50" id="sidebar">
        <div class="p-6 border-b border-slate-700">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 bg-indigo-600 rounded-lg flex items-center justify-center">
                    <i class="fas fa-crown text-white"></i>
                </div>
                <div class="sidebar-text">
                    <h2 class="text-white font-bold text-lg">Super Admin</h2>
                    <p class="text-slate-400 text-sm">Painel de Controle</p>
                </div>
            </div>
        </div>

        <nav class="mt-6">
            <div class="sidebar-item active" data-tab="visao-geral">
                <i class="fas fa-chart-line text-xl"></i>
                <span>Visão Geral</span>
            </div>
            <div class="sidebar-item" data-tab="gerenciar-escolas">
                <i class="fas fa-school text-xl"></i>
                <span>Gerenciar Escolas</span>
            </div>
            <div class="sidebar-item" data-tab="solicitacoes">
                <i class="fas fa-envelope-open-text text-xl"></i>
                <span>Solicitações</span>
            </div>
            <div class="sidebar-item" data-tab="projetos-sem-avaliacao">
                <i class="fas fa-clock text-xl"></i>
                <span>Projetos Pendentes</span>
            </div>
            <div class="sidebar-item" data-tab="ranking-projetos">
                <i class="fas fa-trophy text-xl"></i>
                <span>Ranking</span>
            </div>
            <div class="sidebar-item" data-tab="resumo-avaliadores">
                <i class="fas fa-user-tie text-xl"></i>
                <span>Avaliadores</span>
            </div>
        </nav>

        <div class="absolute bottom-6 left-6 right-6">
            <button id="collapse-btn" class="w-full p-3 bg-slate-700 hover:bg-slate-600 text-white rounded-lg transition-colors">
                <i class="fas fa-chevron-left"></i>
                <span class="ml-2 sidebar-text">Recolher</span>
            </button>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content pt-4 md:pt-6" id="main-content">
        <div class="px-4 md:px-6 lg:px-8 pb-20">
            <!-- Header -->
            <div class="mb-8 mt-16 md:mt-0">
                <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                    <div>
                        <h1 class="text-3xl md:text-4xl font-bold text-gray-900 mb-2">Dashboard</h1>
                        <p class="text-gray-600">Gerencie o sistema e monitore as atividades</p>
                    </div>
                    <a href="/superadmin/escolas/nova" class="bg-indigo-600 hover:bg-indigo-700 text-white px-6 py-3 rounded-xl font-semibold transition-all duration-200 hover:scale-105 shadow-lg flex items-center gap-2">
                        <i class="fas fa-plus"></i>
                        <span>Nova Escola</span>
                    </a>
                </div>
            </div>

            <!-- Flash Messages -->
            <% if (success_msg && success_msg.length > 0) { %>
                <div class="mb-6 p-4 bg-green-50 border-l-4 border-green-500 rounded-r-lg">
                    <div class="flex items-center">
                        <i class="fas fa-check-circle text-green-500 mr-3"></i>
                        <span class="text-green-700 font-medium"><%= success_msg %></span>
                    </div>
                </div>
            <% } %>
            <% if (error_msg && error_msg.length > 0) { %>
                <div class="mb-6 p-4 bg-red-50 border-l-4 border-red-500 rounded-r-lg">
                    <div class="flex items-center">
                        <i class="fas fa-exclamation-circle text-red-500 mr-3"></i>
                        <span class="text-red-700 font-medium"><%= error_msg %></span>
                    </div>
                </div>
            <% } %>

            <!-- Tab Content: Visão Geral -->
            <div id="visao-geral-tab" class="tab-content active">
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
                    <!-- Escolas Card -->
                    <div class="stat-card rounded-2xl p-6 bg-gradient-to-br from-blue-500 to-blue-600 text-white">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-blue-100 text-sm font-medium">Total de Escolas</p>
                                <p class="text-3xl font-bold mt-2"><%= totalEscolas ?? 'N/A' %></p>
                            </div>
                            <div class="p-3 bg-blue-400 rounded-full">
                                <i class="fas fa-school text-2xl"></i>
                            </div>
                        </div>
                    </div>

                    <!-- Admins Card -->
                    <div class="stat-card rounded-2xl p-6 bg-gradient-to-br from-green-500 to-green-600 text-white">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-green-100 text-sm font-medium">Administradores</p>
                                <p class="text-3xl font-bold mt-2"><%= totalAdmins ?? 'N/A' %></p>
                            </div>
                            <div class="p-3 bg-green-400 rounded-full">
                                <i class="fas fa-user-shield text-2xl"></i>
                            </div>
                        </div>
                    </div>

                    <!-- Avaliadores Card -->
                    <div class="stat-card rounded-2xl p-6 bg-gradient-to-br from-yellow-500 to-yellow-600 text-white">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-yellow-100 text-sm font-medium">Avaliadores</p>
                                <p class="text-3xl font-bold mt-2"><%= totalAvaliadores ?? 'N/A' %></p>
                            </div>
                            <div class="p-3 bg-yellow-400 rounded-full">
                                <i class="fas fa-user-tie text-2xl"></i>
                            </div>
                        </div>
                    </div>

                    <!-- Projetos Card -->
                    <div class="stat-card rounded-2xl p-6 bg-gradient-to-br from-purple-500 to-purple-600 text-white">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-purple-100 text-sm font-medium">Projetos</p>
                                <p class="text-3xl font-bold mt-2"><%= totalProjetos ?? 'N/A' %></p>
                            </div>
                            <div class="p-3 bg-purple-400 rounded-full">
                                <i class="fas fa-lightbulb text-2xl"></i>
                            </div>
                        </div>
                    </div>

                    <!-- Avaliações Card -->
                    <div class="stat-card rounded-2xl p-6 bg-gradient-to-br from-indigo-500 to-indigo-600 text-white">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-indigo-100 text-sm font-medium">Avaliações</p>
                                <p class="text-3xl font-bold mt-2"><%= totalAvaliacoes ?? 'N/A' %></p>
                            </div>
                            <div class="p-3 bg-indigo-400 rounded-full">
                                <i class="fas fa-star-half-alt text-2xl"></i>
                            </div>
                        </div>
                    </div>

                    <!-- Solicitações Card -->
                    <div class="stat-card rounded-2xl p-6 bg-gradient-to-br from-red-500 to-red-600 text-white">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-red-100 text-sm font-medium">Solicitações</p>
                                <p class="text-3xl font-bold mt-2"><%= totalSolicitacoesPendentes ?? 'N/A' %></p>
                            </div>
                            <div class="p-3 bg-red-400 rounded-full">
                                <i class="fas fa-envelope-open-text text-2xl"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tab Content: Gerenciar Escolas -->
            <div id="gerenciar-escolas-tab" class="tab-content">
                <div class="glass-card rounded-2xl p-6">
                    <h3 class="text-2xl font-bold text-gray-800 mb-6 flex items-center gap-3">
                        <i class="fas fa-school text-indigo-600"></i>
                        Gerenciar Escolas
                    </h3>
                    
                    <% if (typeof escolasDetalhes !== 'undefined' && escolasDetalhes.length > 0) { %>
                        <div class="overflow-x-auto">
                            <table class="modern-table w-full">
                                <thead>
                                    <tr>
                                        <th>Escola</th>
                                        <th>Admin Principal</th>
                                        <th class="text-center">Projetos</th>
                                        <th class="text-center">Avaliadores</th>
                                        <th class="text-center">Avaliações</th>
                                        <th class="text-center">Status</th>
                                        <th class="text-center">Ações</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <% escolasDetalhes.forEach(escola => { %>
                                        <tr>
                                            <td class="font-semibold text-gray-900"><%= escola.nome %></td>
                                            <td class="text-gray-600"><%= escola.adminEmail %></td>
                                            <td class="text-center font-medium"><%= escola.numProjetos %></td>
                                            <td class="text-center font-medium"><%= escola.numAvaliadores %></td>
                                            <td class="text-center font-medium"><%= escola.numAvaliacoes %></td>
                                            <td class="text-center">
                                                <% if (escola.ativa) { %>
                                                    <span class="px-3 py-1 bg-green-100 text-green-800 rounded-full text-sm font-medium">Ativa</span>
                                                <% } else { %>
                                                    <span class="px-3 py-1 bg-red-100 text-red-800 rounded-full text-sm font-medium">Inativa</span>
                                                <% } %>
                                            </td>
                                            <td class="text-center">
                                                <div class="flex items-center justify-center gap-2">
                                                    <a href="/superadmin/escolas/<%= escola._id %>/editar" class="action-btn edit" title="Editar">
                                                        <i class="fas fa-edit"></i>
                                                    </a>
                                                    
                                                    <% if (escola.ativa) { %>
                                                        <a href="/superadmin/escolas/<%= escola._id %>/inativar" class="action-btn toggle" title="Inativar"
                                                            onclick="return confirm('Tem certeza que deseja INATIVAR esta escola?');">
                                                            <i class="fas fa-pause"></i>
                                                        </a>
                                                    <% } else { %>
                                                        <a href="/superadmin/escolas/<%= escola._id %>/ativar" class="action-btn activate" title="Ativar"
                                                            onclick="return confirm('Tem certeza que deseja ATIVAR esta escola?');">
                                                            <i class="fas fa-play"></i>
                                                        </a>
                                                    <% } %>

                                                    <button type="button" 
                                                            onclick="confirmResetAdminPassword('<%= escola._id %>', '<%= escola.nome %>', '<%= escola.adminEmail %>');" 
                                                            class="action-btn reset" title="Redefinir Senha">
                                                        <i class="fas fa-key"></i>
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>
                                    <% }) %>
                                </tbody>
                            </table>
                        </div>
                    <% } else { %>
                        <div class="text-center py-12">
                            <i class="fas fa-school text-6xl text-gray-300 mb-4"></i>
                            <p class="text-gray-500 text-lg">Nenhuma escola cadastrada ainda.</p>
                        </div>
                    <% } %>
                </div>
            </div>

            <!-- Tab Content: Solicitações -->
            <div id="solicitacoes-tab" class="tab-content">
                <div class="glass-card rounded-2xl p-6">
                    <h3 class="text-2xl font-bold text-gray-800 mb-6 flex items-center gap-3">
                        <i class="fas fa-envelope-open-text text-indigo-600"></i>
                        Gerenciar Solicitações
                    </h3>
                    
                    <% if (typeof solicitacoes !== 'undefined' && solicitacoes.length > 0) { %>
                        <div class="overflow-x-auto">
                            <table class="modern-table w-full">
                                <thead>
                                    <tr>
                                        <th>Escola</th>
                                        <th>Solicitante</th>
                                        <th>E-mail</th>
                                        <th>Data</th>
                                        <th class="text-center">Ações</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <% solicitacoes.forEach(solicitacao => { %>
                                        <tr>
                                            <td class="font-semibold text-gray-900"><%= solicitacao.nomeEscola %></td>
                                            <td class="text-gray-600"><%= solicitacao.nomeResponsavel %></td>
                                            <td class="text-gray-600"><%= solicitacao.emailContato %></td>
                                            <td class="text-gray-600"><%= new Date(solicitacao.dataSolicitacao).toLocaleDateString('pt-BR') %></td>
                                            <td class="text-center">
                                                <div class="flex items-center justify-center gap-2">
                                                    <a href="/superadmin/solicitacoes/<%= solicitacao._id %>/editar" class="action-btn edit" title="Ver Detalhes">
                                                        <i class="fas fa-eye"></i>
                                                    </a>
                                                    <form action="/superadmin/solicitacoes/<%= solicitacao._id %>/aprovar" method="POST" class="inline">
                                                        <button type="submit" class="action-btn activate" title="Aprovar"
                                                            onclick="return confirm('Tem certeza que deseja APROVAR esta solicitação?');">
                                                            <i class="fas fa-check"></i>
                                                        </button>
                                                    </form>
                                                    <form action="/superadmin/solicitacoes/<%= solicitacao._id %>/rejeitar" method="POST" class="inline">
                                                        <button type="submit" class="action-btn reset" title="Rejeitar"
                                                            onclick="return confirm('Tem certeza que deseja REJEITAR esta solicitação?');">
                                                            <i class="fas fa-times"></i>
                                                        </button>
                                                    </form>
                                                </div>
                                            </td>
                                        </tr>
                                    <% }) %>
                                </tbody>
                            </table>
                        </div>
                    <% } else { %>
                        <div class="text-center py-12">
                            <i class="fas fa-envelope-open-text text-6xl text-gray-300 mb-4"></i>
                            <p class="text-gray-500 text-lg">Nenhuma solicitação pendente.</p>
                        </div>
                    <% } %>
                </div>
            </div>

            <!-- Tab Content: Projetos Pendentes -->
            <div id="projetos-sem-avaliacao-tab" class="tab-content">
                <div class="glass-card rounded-2xl p-6">
                    <h3 class="text-2xl font-bold text-gray-800 mb-6 flex items-center gap-3">
                        <i class="fas fa-clock text-indigo-600"></i>
                        Projetos Pendentes
                    </h3>
                    
                    <div class="mb-6">
                        <form action="/superadmin/dashboard" method="GET" class="flex items-center gap-4">
                            <input type="hidden" name="tab" value="projetos-sem-avaliacao">
                            <label class="text-gray-700 font-medium">Filtrar por Escola:</label>
                            <select name="escolaId" onchange="this.form.submit()" class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
                                <option value="">-- Todas as Escolas --</option>
                                <% if (typeof todasEscolas !== 'undefined' && todasEscolas.length > 0) { %>
                                    <% todasEscolas.forEach(escola => { %>
                                        <option value="<%= escola._id %>" <%= selectedEscolaId === String(escola._id) ? 'selected' : '' %>>
                                            <%= escola.nome %>
                                        </option>
                                    <% }) %>
                                <% } %>
                            </select>
                        </form>
                    </div>

                    <% if (typeof selectedEscolaId !== 'undefined' && selectedEscolaId) { %>
                        <% if (typeof projetosNaoAvaliados !== 'undefined' && projetosNaoAvaliados.length > 0) { %>
                            <div class="overflow-x-auto">
                                <table class="modern-table w-full">
                                    <thead>
                                        <tr>
                                            <th>Projeto</th>
                                            <th>Turma</th>
                                            <th>Avaliadores</th>
                                            <th class="text-center">Recebidas</th>
                                            <th class="text-center">Necessárias</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <% projetosNaoAvaliados.forEach(projeto => { %>
                                            <tr>
                                                <td class="font-semibold text-gray-900"><%= projeto.titulo %></td>
                                                <td class="text-gray-600"><%= projeto.turma %></td>
                                                <td class="text-gray-600"><%= projeto.avaliadoresDesignados %></td>
                                                <td class="text-center font-medium"><%= projeto.numAvaliacoesRecebidas %></td>
                                                <td class="text-center font-medium"><%= projeto.totalCriteriosNecessarios %></td>
                                            </tr>
                                        <% }) %>
                                    </tbody>
                                </table>
                            </div>
                        <% } else { %>
                            <div class="text-center py-12">
                                <i class="fas fa-check-circle text-6xl text-green-300 mb-4"></i>
                                <p class="text-gray-500 text-lg">Todos os projetos foram avaliados!</p>
                            </div>
                        <% } %>
                    <% } else { %>
                        <div class="text-center py-12">
                            <i class="fas fa-arrow-up text-6xl text-gray-300 mb-4"></i>
                            <p class="text-gray-500 text-lg">Selecione uma escola para ver os projetos pendentes.</p>
                        </div>
                    <% } %>
                </div>
            </div>

            <!-- Tab Content: Ranking -->
            <div id="ranking-projetos-tab" class="tab-content">
                <div class="glass-card rounded-2xl p-6">
                    <h3 class="text-2xl font-bold text-gray-800 mb-6 flex items-center gap-3">
                        <i class="fas fa-trophy text-indigo-600"></i>
                        Ranking de Projetos
                    </h3>
                    
                    <% if (typeof rankingProjetosPorCategoria !== 'undefined' && Object.keys(rankingProjetosPorCategoria).length > 0) { %>
                        <div class="space-y-8">
                            <% for (const categoriaNome in rankingProjetosPorCategoria) { %>
                                <% const projetosNaCategoria = rankingProjetosPorCategoria[categoriaNome]; %>
                                <div class="bg-white rounded-xl p-6 shadow-sm border border-gray-200">
                                    <h4 class="text-xl font-bold text-gray-800 mb-4 flex items-center gap-2">
                                        <i class="fas fa-medal text-yellow-500"></i>
                                        <%= categoriaNome %>
                                    </h4>
                                    
                                    <% if (projetosNaCategoria && projetosNaCategoria.length > 0) { %>
                                        <div class="space-y-3">
                                            <% projetosNaCategoria.slice(0, 10).forEach((projeto, index) => { %>
                                                <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors">
                                                    <div class="flex items-center gap-4">
                                                        <div class="flex items-center justify-center w-8 h-8 rounded-full font-bold text-white
                                                            <%= index === 0 ? 'bg-yellow-500' : index === 1 ? 'bg-gray-400' : index === 2 ? 'bg-orange-500' : 'bg-gray-300' %>">
                                                            <%= index + 1 %>
                                                        </div>
                                                        <div>
                                                            <h5 class="font-semibold text-gray-900"><%= projeto.titulo %></h5>
                                                            <p class="text-sm text-gray-600"><%= projeto.escola %> - <%= projeto.turma %></p>
                                                        </div>
                                                    </div>
                                                    <div class="text-right">
                                                        <p class="text-lg font-bold text-indigo-600"><%= projeto.notaFinal.toFixed(1) %></p>
                                                        <p class="text-sm text-gray-500"><%= projeto.numAvaliacoes %> avaliações</p>
                                                    </div>
                                                </div>
                                            <% }) %>
                                        </div>
                                    <% } else { %>
                                        <div class="text-center py-8">
                                            <i class="fas fa-trophy text-4xl text-gray-300 mb-2"></i>
                                            <p class="text-gray-500">Nenhum projeto avaliado nesta categoria ainda.</p>
                                        </div>
                                    <% } %>
                                </div>
                            <% } %>
                        </div>
                    <% } else { %>
                        <div class="text-center py-12">
                            <i class="fas fa-trophy text-6xl text-gray-300 mb-4"></i>
                            <p class="text-gray-500 text-lg">Nenhum projeto avaliado ainda.</p>
                        </div>
                    <% } %>
                </div>
            </div>

            <!-- Tab Content: Resumo Avaliadores -->
            <div id="resumo-avaliadores-tab" class="tab-content">
                <div class="glass-card rounded-2xl p-6">
                    <h3 class="text-2xl font-bold text-gray-800 mb-6 flex items-center gap-3">
                        <i class="fas fa-user-tie text-indigo-600"></i>
                        Resumo dos Avaliadores
                    </h3>
                    
                    <% if (typeof resumoAvaliadores !== 'undefined' && resumoAvaliadores.length > 0) { %>
                        <div class="overflow-x-auto">
                            <table class="modern-table w-full">
                                <thead>
                                    <tr>
                                        <th>Avaliador</th>
                                        <th>E-mail</th>
                                        <th>Escola</th>
                                        <th class="text-center">Avaliações</th>
                                        <th class="text-center">Projetos</th>
                                        <th class="text-center">Última Atividade</th>
                                        <th class="text-center">Status</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <% resumoAvaliadores.forEach(avaliador => { %>
                                        <tr>
                                            <td class="font-semibold text-gray-900"><%= avaliador.nome %></td>
                                            <td class="text-gray-600"><%= avaliador.email %></td>
                                            <td class="text-gray-600"><%= avaliador.nomeEscola %></td>
                                            <td class="text-center font-medium"><%= avaliador.totalAvaliacoes %></td>
                                            <td class="text-center font-medium"><%= avaliador.projetosAvaliados %></td>
                                            <td class="text-center text-gray-600">
                                                <% if (avaliador.ultimaAtividade) { %>
                                                    <%= new Date(avaliador.ultimaAtividade).toLocaleDateString('pt-BR') %>
                                                <% } else { %>
                                                    <span class="text-gray-400">Nunca</span>
                                                <% } %>
                                            </td>
                                            <td class="text-center">
                                                <% if (avaliador.ativo) { %>
                                                    <span class="px-3 py-1 bg-green-100 text-green-800 rounded-full text-sm font-medium">Ativo</span>
                                                <% } else { %>
                                                    <span class="px-3 py-1 bg-red-100 text-red-800 rounded-full text-sm font-medium">Inativo</span>
                                                <% } %>
                                            </td>
                                        </tr>
                                    <% }) %>
                                </tbody>
                            </table>
                        </div>
                    <% } else { %>
                        <div class="text-center py-12">
                            <i class="fas fa-user-tie text-6xl text-gray-300 mb-4"></i>
                            <p class="text-gray-500 text-lg">Nenhum avaliador cadastrado ainda.</p>
                        </div>
                    <% } %>
                </div>
            </div>
        </div>
    </div>

    <!-- Floating Action Button -->
    <button class="floating-btn" onclick="window.location.href='/superadmin/escolas/nova'">
        <i class="fas fa-plus text-xl"></i>
    </button>

    <!-- JavaScript -->
    <script>
        // Mobile menu toggle
        const mobileMenuBtn = document.getElementById('mobile-menu-btn');
        const mobileOverlay = document.getElementById('mobile-overlay');
        const sidebar = document.getElementById('sidebar');

        mobileMenuBtn.addEventListener('click', function() {
            sidebar.classList.toggle('mobile-open');
            mobileOverlay.classList.toggle('active');
        });

        mobileOverlay.addEventListener('click', function() {
            sidebar.classList.remove('mobile-open');
            mobileOverlay.classList.remove('active');
        });

        // Sidebar collapse
        const collapseBtn = document.getElementById('collapse-btn');
        const mainContent = document.getElementById('main-content');

        collapseBtn.addEventListener('click', function() {
            sidebar.classList.toggle('collapsed');
            mainContent.classList.toggle('expanded');
            
            const icon = collapseBtn.querySelector('i');
            if (sidebar.classList.contains('collapsed')) {
                icon.classList.remove('fa-chevron-left');
                icon.classList.add('fa-chevron-right');
            } else {
                icon.classList.remove('fa-chevron-right');
                icon.classList.add('fa-chevron-left');
            }
        });

        // Tab switching
        const sidebarItems = document.querySelectorAll('.sidebar-item');
        const tabContents = document.querySelectorAll('.tab-content');

        sidebarItems.forEach(item => {
            item.addEventListener('click', function() {
                const targetTab = this.getAttribute('data-tab');
                
                // Remove active class from all sidebar items
                sidebarItems.forEach(sidebarItem => {
                    sidebarItem.classList.remove('active');
                });
                
                // Add active class to clicked item
                this.classList.add('active');
                
                // Hide all tab contents
                tabContents.forEach(content => {
                    content.classList.remove('active');
                });
                
                // Show target tab content
                const targetContent = document.getElementById(targetTab + '-tab');
                if (targetContent) {
                    targetContent.classList.add('active');
                }

                // Close mobile menu if open
                if (window.innerWidth <= 768) {
                    sidebar.classList.remove('mobile-open');
                    mobileOverlay.classList.remove('active');
                }
            });
        });

        // Check for tab parameter in URL
        const urlParams = new URLSearchParams(window.location.search);
        const tabParam = urlParams.get('tab');
        
        if (tabParam) {
            // Find the sidebar item with the matching data-tab
            const targetSidebarItem = document.querySelector(`[data-tab="${tabParam}"]`);
            if (targetSidebarItem) {
                // Remove active from all
                sidebarItems.forEach(item => item.classList.remove('active'));
                tabContents.forEach(content => content.classList.remove('active'));
                
                // Activate the target
                targetSidebarItem.classList.add('active');
                const targetContent = document.getElementById(tabParam + '-tab');
                if (targetContent) {
                    targetContent.classList.add('active');
                }
            }
        }

        // Confirm reset admin password
        function confirmResetAdminPassword(escolaId, nomeEscola, emailAdmin) {
            if (confirm(`Tem certeza que deseja redefinir a senha do administrador da escola "${nomeEscola}" (${emailAdmin})?\n\nUma nova senha será gerada e enviada por e-mail.`)) {
                // Create a form and submit it
                const form = document.createElement('form');
                form.method = 'POST';
                form.action = `/superadmin/escolas/${escolaId}/resetar-senha-admin`;
                
                // Add CSRF token if available
                const csrfToken = document.querySelector('meta[name="csrf-token"]');
                if (csrfToken) {
                    const csrfInput = document.createElement('input');
                    csrfInput.type = 'hidden';
                    csrfInput.name = '_token';
                    csrfInput.value = csrfToken.getAttribute('content');
                    form.appendChild(csrfInput);
                }
                
                document.body.appendChild(form);
                form.submit();
            }
        }

        // Auto-refresh data every 30 seconds for real-time updates
        setInterval(function() {
            // Only refresh if we're on the overview tab
            const overviewTab = document.getElementById('visao-geral-tab');
            if (overviewTab && overviewTab.classList.contains('active')) {
                // Subtle indication that data is being refreshed
                const cards = document.querySelectorAll('.stat-card');
                cards.forEach(card => {
                    card.style.opacity = '0.8';
                    setTimeout(() => {
                        card.style.opacity = '1';
                    }, 500);
                });
            }
        }, 30000);

        // Smooth scrolling for internal links
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            });
        });

        // Add loading state to action buttons
        document.querySelectorAll('.action-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const icon = this.querySelector('i');
                const originalClass = icon.className;
                
                // Add loading spinner
                icon.className = 'fas fa-spinner fa-spin';
                this.style.pointerEvents = 'none';
                
                // Reset after 3 seconds (fallback)
                setTimeout(() => {
                    icon.className = originalClass;
                    this.style.pointerEvents = 'auto';
                }, 3000);
            });
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            // Alt + 1-6 for quick tab switching
            if (e.altKey && e.key >= '1' && e.key <= '6') {
                e.preventDefault();
                const tabIndex = parseInt(e.key) - 1;
                const sidebarItem = sidebarItems[tabIndex];
                if (sidebarItem) {
                    sidebarItem.click();
                }
            }
            
            // Escape to close mobile menu
            if (e.key === 'Escape') {
                sidebar.classList.remove('mobile-open');
                mobileOverlay.classList.remove('active');
            }
        });

        // Initialize tooltips (if using a tooltip library)
        document.querySelectorAll('[title]').forEach(element => {
            element.addEventListener('mouseenter', function() {
                // Simple tooltip implementation
                const tooltip = document.createElement('div');
                tooltip.className = 'absolute z-50 px-2 py-1 bg-gray-800 text-white text-sm rounded shadow-lg';
                tooltip.textContent = this.getAttribute('title');
                tooltip.style.top = this.offsetTop - 30 + 'px';
                tooltip.style.left = this.offsetLeft + 'px';
                this.appendChild(tooltip);
            });
            
            element.addEventListener('mouseleave', function() {
                const tooltip = this.querySelector('.absolute.z-50');
                if (tooltip) {
                    tooltip.remove();
                }
            });
        });

        // Check for flash messages and auto-hide them
        const flashMessages = document.querySelectorAll('.bg-green-50, .bg-red-50');
        flashMessages.forEach(message => {
            setTimeout(() => {
                message.style.opacity = '0';
                message.style.transform = 'translateY(-10px)';
                setTimeout(() => {
                    message.remove();
                }, 300);
            }, 5000);
        });

        // Add ripple effect to buttons
        function addRippleEffect(button) {
            button.addEventListener('click', function(e) {
                const ripple = document.createElement('span');
                const rect = this.getBoundingClientRect();
                const size = Math.max(rect.width, rect.height);
                const x = e.clientX - rect.left - size / 2;
                const y = e.clientY - rect.top - size / 2;
                
                ripple.style.width = ripple.style.height = size + 'px';
                ripple.style.left = x + 'px';
                ripple.style.top = y + 'px';
                ripple.classList.add('ripple');
                
                this.appendChild(ripple);
                
                setTimeout(() => {
                    ripple.remove();
                }, 600);
            });
        }

        // Apply ripple effect to buttons
        document.querySelectorAll('.action-btn, .floating-btn').forEach(addRippleEffect);

        // Add CSS for ripple effect
        const style = document.createElement('style');
        style.textContent = `
            .ripple {
                position: absolute;
                border-radius: 50%;
                background: rgba(255, 255, 255, 0.6);
                transform: scale(0);
                animation: ripple-animation 0.6s linear;
                pointer-events: none;
            }
            
            @keyframes ripple-animation {
                to {
                    transform: scale(4);
                    opacity: 0;
                }
            }
        `;
        document.head.appendChild(style);

        console.log('Dashboard Super Admin carregado com sucesso!');
    </script>
</body>
</html>