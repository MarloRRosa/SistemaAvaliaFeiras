<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= titulo %></title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            /* Design System Modernizado */
            --primary-blue: #2563eb;
            --primary-blue-light: #dbeafe;
            --primary-green: #059669;
            --primary-green-light: #d1fae5;
            --primary-yellow: #d97706;
            --primary-yellow-light: #fef3c7;
            --primary-purple: #7c3aed;
            --primary-purple-light: #ede9fe;
            --primary-indigo: #4f46e5;
            --primary-indigo-light: #e0e7ff;
            --primary-red: #dc2626;
            --primary-red-light: #fee2e2;
            
            /* Shadows */
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }

        /* Navegação de Abas Modernizada */
        .tab-button {
            padding: 0.875rem 1.5rem;
            font-size: 0.875rem;
            font-weight: 600;
            color: #6b7280;
            background: white;
            border-radius: 0.75rem;
            border: 2px solid #e5e7eb;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            white-space: nowrap;
            margin-right: 0.5rem;
            margin-bottom: 0.5rem;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }

        .tab-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.6), transparent);
            transition: left 0.5s;
        }

        .tab-button:hover::before {
            left: 100%;
        }

        .tab-button:hover {
            color: var(--primary-blue);
            border-color: var(--primary-blue);
            background: var(--primary-blue-light);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .tab-button.active {
            color: white;
            background: linear-gradient(135deg, var(--primary-blue), #1d4ed8);
            border-color: var(--primary-blue);
            box-shadow: var(--shadow-lg);
            transform: translateY(-1px);
        }

        /* Conteúdo das Abas */
        .tab-content {
            padding: 2rem;
            border-radius: 1rem;
            box-shadow: var(--shadow-lg);
            background: white;
            position: relative;
            overflow: hidden;
        }

        .tab-content::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary-blue), var(--primary-purple), var(--primary-indigo));
        }

        .tab-content.hidden {
            display: none;
        }

        /* Cards Estatísticos Modernizados */
        .stat-card {
            background: white;
            border-radius: 1.25rem;
            padding: 1.5rem;
            box-shadow: var(--shadow-md);
            border: 1px solid #f3f4f6;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .stat-card::after {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 100px;
            height: 100px;
            opacity: 0.1;
            transform: translate(30px, -30px);
        }

        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-xl);
        }

        .stat-card.blue::after {
            background: radial-gradient(circle, var(--primary-blue) 0%, transparent 70%);
        }

        .stat-card.green::after {
            background: radial-gradient(circle, var(--primary-green) 0%, transparent 70%);
        }

        .stat-card.yellow::after {
            background: radial-gradient(circle, var(--primary-yellow) 0%, transparent 70%);
        }

        .stat-card.purple::after {
            background: radial-gradient(circle, var(--primary-purple) 0%, transparent 70%);
        }

        .stat-card.indigo::after {
            background: radial-gradient(circle, var(--primary-indigo) 0%, transparent 70%);
        }

        .stat-card.red::after {
            background: radial-gradient(circle, var(--primary-red) 0%, transparent 70%);
        }

        /* Ícones dos Cards */
        .stat-icon {
            width: 3.5rem;
            height: 3.5rem;
            border-radius: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            margin-bottom: 1rem;
            position: relative;
            z-index: 1;
        }

        .stat-icon.blue {
            background: linear-gradient(135deg, var(--primary-blue-light), #bfdbfe);
            color: var(--primary-blue);
        }

        .stat-icon.green {
            background: linear-gradient(135deg, var(--primary-green-light), #a7f3d0);
            color: var(--primary-green);
        }

        .stat-icon.yellow {
            background: linear-gradient(135deg, var(--primary-yellow-light), #fed7aa);
            color: var(--primary-yellow);
        }

        .stat-icon.purple {
            background: linear-gradient(135deg, var(--primary-purple-light), #c4b5fd);
            color: var(--primary-purple);
        }

        .stat-icon.indigo {
            background: linear-gradient(135deg, var(--primary-indigo-light), #c7d2fe);
            color: var(--primary-indigo);
        }

        .stat-icon.red {
            background: linear-gradient(135deg, var(--primary-red-light), #fecaca);
            color: var(--primary-red);
        }

        /* Tabelas Modernizadas */
        .modern-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
            border-radius: 1rem;
            overflow: hidden;
            box-shadow: var(--shadow-md);
        }

        .modern-table th {
            padding: 1rem 1.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, #f8fafc, #f1f5f9);
            color: #374151;
            text-transform: uppercase;
            font-size: 0.75rem;
            letter-spacing: 0.05em;
            border-bottom: 2px solid #e5e7eb;
        }

        .modern-table td {
            padding: 1rem 1.5rem;
            border-bottom: 1px solid #f3f4f6;
            color: #374151;
            vertical-align: middle;
        }

        .modern-table tbody tr {
            transition: all 0.2s ease;
        }

        .modern-table tbody tr:hover {
            background: linear-gradient(135deg, #f8fafc, #f1f5f9);
            transform: scale(1.005);
        }

        .modern-table tbody tr:nth-child(even) {
            background: rgba(248, 250, 252, 0.5);
        }

        /* Badges Modernizados */
        .modern-badge {
            padding: 0.5rem 1rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
            letter-spacing: 0.025em;
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
        }

        .badge-success {
            background: linear-gradient(135deg, var(--primary-green-light), #a7f3d0);
            color: var(--primary-green);
            border: 1px solid var(--primary-green);
        }

        .badge-danger {
            background: linear-gradient(135deg, var(--primary-red-light), #fecaca);
            color: var(--primary-red);
            border: 1px solid var(--primary-red);
        }

        /* Botões de Ação */
        .action-btn {
            padding: 0.5rem;
            border-radius: 0.5rem;
            transition: all 0.2s ease;
            border: none;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        .action-btn:hover {
            transform: scale(1.1);
            box-shadow: var(--shadow-md);
        }

        /* Header Principal */
        .main-header {
            background: linear-gradient(135deg, white, #f8fafc);
            border-radius: 1.25rem;
            padding: 2rem;
            box-shadow: var(--shadow-lg);
            border: 1px solid #e5e7eb;
            margin-bottom: 2rem;
        }

        /* Botões do Header */
        .header-btn {
            padding: 0.75rem 1.5rem;
            border-radius: 0.75rem;
            font-weight: 600;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.3s ease;
            box-shadow: var(--shadow-sm);
        }

        .header-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .btn-primary-modern {
            background: linear-gradient(135deg, var(--primary-blue), #1d4ed8);
            color: white;
        }

        .btn-danger-modern {
            background: linear-gradient(135deg, var(--primary-red), #b91c1c);
            color: white;
        }

        /* Modal Modernizado */
        .modern-modal {
            backdrop-filter: blur(8px);
            background: rgba(0, 0, 0, 0.6);
        }

        .modal-content-modern {
            border-radius: 1.25rem;
            box-shadow: var(--shadow-xl);
            border: 1px solid #e5e7eb;
        }

        /* Formulários */
        .modern-select {
            border-radius: 0.75rem;
            border: 2px solid #e5e7eb;
            transition: all 0.3s ease;
            box-shadow: var(--shadow-sm);
        }

        .modern-select:focus {
            border-color: var(--primary-blue);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        /* Animações */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .animate-fade-in-up {
            animation: fadeInUp 0.6s ease-out;
        }

        /* Mensagens Flash Modernizadas */
        .flash-message {
            border-radius: 1rem;
            padding: 1rem 1.5rem;
            margin-bottom: 1.5rem;
            border-left: 4px solid;
            box-shadow: var(--shadow-md);
        }

        .flash-success {
            background: linear-gradient(135deg, var(--primary-green-light), #d1fae5);
            border-left-color: var(--primary-green);
            color: #065f46;
        }

        .flash-error {
            background: linear-gradient(135deg, var(--primary-red-light), #fee2e2);
            border-left-color: var(--primary-red);
            color: #991b1b;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-slate-50 to-slate-100 min-h-screen">
    <main class="p-6 md:p-8">
        <div class="max-w-7xl mx-auto">
            <!-- Header Principal -->
            <div class="main-header animate-fade-in-up">
                <div class="flex flex-col md:flex-row justify-between items-start md:items-center">
                    <div>
                        <h1 class="text-4xl font-bold text-gray-800 mb-2">Painel Super Admin</h1>
                        <p class="text-gray-600 text-lg">Gerencie escolas, projetos e avaliações do sistema</p>
                    </div>
                    <div class="flex flex-col md:flex-row items-center gap-4 mt-4 md:mt-0">
                        <a href="/superadmin/escolas/nova" class="header-btn btn-primary-modern">
                            <i class="fas fa-plus"></i>
                            Nova Escola
                        </a>
                        <a href="/superadmin/logout" class="header-btn btn-danger-modern">
                            <i class="fas fa-sign-out-alt"></i>
                            Sair
                        </a>
                    </div>
                </div>
            </div>

            <!-- Mensagens Flash -->
            <% if (success_msg && success_msg.length > 0) { %>
                <div class="flash-message flash-success animate-fade-in-up" role="alert">
                    <div class="flex items-center">
                        <i class="fas fa-check-circle text-xl mr-3"></i>
                        <div>
                            <strong class="font-bold">Sucesso!</strong>
                            <span class="block sm:inline ml-2"><%= success_msg %></span>
                        </div>
                    </div>
                </div>
            <% } %>
            <% if (error_msg && error_msg.length > 0) { %>
                <div class="flash-message flash-error animate-fade-in-up" role="alert">
                    <div class="flex items-center">
                        <i class="fas fa-exclamation-circle text-xl mr-3"></i>
                        <div>
                            <strong class="font-bold">Erro!</strong>
                            <span class="block sm:inline ml-2"><%= error_msg %></span>
                        </div>
                    </div>
                </div>
            <% } %>

            <!-- Navegação por Abas -->
            <div class="flex flex-wrap mb-8 animate-fade-in-up" style="animation-delay: 0.2s;">
                <button class="tab-button <%= activeTab === 'visao-geral' ? 'active' : '' %>" data-tab="visao-geral">
                    <i class="fas fa-chart-line mr-2"></i>Visão Geral
                </button>
                <button class="tab-button <%= activeTab === 'gerenciar-escolas' ? 'active' : '' %>" data-tab="gerenciar-escolas">
                    <i class="fas fa-school mr-2"></i>Gerenciar Escolas
                </button>
                <button class="tab-button <%= activeTab === 'solicitacoes' ? 'active' : '' %>" data-tab="solicitacoes">
                    <i class="fas fa-envelope mr-2"></i>Solicitações
                </button>
                <button class="tab-button <%= activeTab === 'projetos-sem-avaliacao' ? 'active' : '' %>" data-tab="projetos-sem-avaliacao">
                    <i class="fas fa-clock mr-2"></i>Projetos Pendentes
                </button>
                <button class="tab-button <%= activeTab === 'relatorio-projetos' ? 'active' : '' %>" data-tab="relatorio-projetos">
                    <i class="fas fa-list-alt mr-2"></i>Relatório Projetos
                </button>
                <button class="tab-button <%= activeTab === 'ranking-projetos' ? 'active' : '' %>" data-tab="ranking-projetos">
                    <i class="fas fa-trophy mr-2"></i>Ranking
                </button>
                <button class="tab-button <%= activeTab === 'resumo-avaliadores' ? 'active' : '' %>" data-tab="resumo-avaliadores">
                    <i class="fas fa-users mr-2"></i>Avaliadores
                </button>
            </div>

            <!-- Conteúdo da Aba: Visão Geral -->
            <div id="visao-geral-tab" class="tab-content <%= activeTab === 'visao-geral' ? '' : 'hidden' %> animate-fade-in-up" style="animation-delay: 0.4s;">
                <h2 class="text-3xl font-bold text-gray-800 mb-8 flex items-center">
                    <i class="fas fa-chart-line text-blue-600 mr-3"></i>
                    Visão Geral do Sistema
                </h2>

                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                    <!-- Card: Total de Escolas -->
                    <div class="stat-card blue">
                        <div class="stat-icon blue">
                            <i class="fas fa-school"></i>
                        </div>
                        <h3 class="text-sm font-semibold text-gray-600 uppercase tracking-wide mb-1">Escolas</h3>
                        <p class="text-3xl font-bold text-gray-800"><%= totalEscolas ?? 'N/A' %></p>
                    </div>

                    <!-- Card: Total de Admins -->
                    <div class="stat-card green">
                        <div class="stat-icon green">
                            <i class="fas fa-user-shield"></i>
                        </div>
                        <h3 class="text-sm font-semibold text-gray-600 uppercase tracking-wide mb-1">Administradores</h3>
                        <p class="text-3xl font-bold text-gray-800"><%= totalAdmins ?? 'N/A' %></p>
                    </div>

                    <!-- Card: Total de Avaliadores -->
                    <div class="stat-card yellow">
                        <div class="stat-icon yellow">
                            <i class="fas fa-user-tie"></i>
                        </div>
                        <h3 class="text-sm font-semibold text-gray-600 uppercase tracking-wide mb-1">Avaliadores</h3>
                        <p class="text-3xl font-bold text-gray-800"><%= totalAvaliadores ?? 'N/A' %></p>
                    </div>

                    <!-- Card: Total de Projetos -->
                    <div class="stat-card purple">
                        <div class="stat-icon purple">
                            <i class="fas fa-lightbulb"></i>
                        </div>
                        <h3 class="text-sm font-semibold text-gray-600 uppercase tracking-wide mb-1">Projetos</h3>
                        <p class="text-3xl font-bold text-gray-800"><%= totalProjetos ?? 'N/A' %></p>
                    </div>

                    <!-- Card: Total de Avaliações -->
                    <div class="stat-card indigo">
                        <div class="stat-icon indigo">
                            <i class="fas fa-star-half-alt"></i>
                        </div>
                        <h3 class="text-sm font-semibold text-gray-600 uppercase tracking-wide mb-1">Avaliações</h3>
                        <p class="text-3xl font-bold text-gray-800"><%= totalAvaliacoes ?? 'N/A' %></p>
                    </div>

                    <!-- Card: Solicitações Pendentes -->
                    <div class="stat-card red">
                        <div class="stat-icon red">
                            <i class="fas fa-envelope-open-text"></i>
                        </div>
                        <h3 class="text-sm font-semibold text-gray-600 uppercase tracking-wide mb-1">Solicitações Pendentes</h3>
                        <p class="text-3xl font-bold text-gray-800"><%= totalSolicitacoesPendentes ?? 'N/A' %></p>
                    </div>
                </div>
            </div>

            <!-- Conteúdo da Aba: Gerenciar Escolas -->
            <div id="gerenciar-escolas-tab" class="tab-content <%= activeTab === 'gerenciar-escolas' ? '' : 'hidden' %>">
                <h2 class="text-3xl font-bold text-gray-800 mb-6 flex items-center">
                    <i class="fas fa-school text-blue-600 mr-3"></i>
                    Gerenciar Escolas
                </h2>
                
                <% if (typeof escolasDetalhes !== 'undefined' && escolasDetalhes.length > 0) { %>
                    <div class="overflow-x-auto">
                        <table class="modern-table">
                            <thead>
                                <tr>
                                    <th>Nome da Escola</th>
                                    <th>Admin Principal</th>
                                    <th class="text-center">Projetos</th>
                                    <th class="text-center">Avaliadores</th>
                                    <th class="text-center">Avaliações</th>
                                    <th class="text-center">Status</th>
                                    <th class="text-center">Ações</th>
                                </tr>
                            </thead>
                            <tbody>
                                <% escolasDetalhes.forEach(escola => { %>
                                    <tr>
                                        <td class="font-semibold text-gray-900"><%= escola.nome %></td>
                                        <td><%= escola.adminEmail %></td>
                                        <td class="text-center font-semibold"><%= escola.numProjetos %></td>
                                        <td class="text-center font-semibold"><%= escola.numAvaliadores %></td>
                                        <td class="text-center font-semibold"><%= escola.numAvaliacoes %></td>
                                        <td class="text-center">
                                            <% if (escola.ativa) { %>
                                                <span class="modern-badge badge-success">
                                                    <i class="fas fa-check-circle"></i>Ativa
                                                </span>
                                            <% } else { %>
                                                <span class="modern-badge badge-danger">
                                                    <i class="fas fa-times-circle"></i>Inativa
                                                </span>
                                            <% } %>
                                        </td>
                                        <td class="text-center">
                                            <div class="flex items-center justify-center gap-2">
                                                <a href="/superadmin/escolas/<%= escola._id %>/editar" title="Editar" class="action-btn text-blue-600 hover:text-blue-800 hover:bg-blue-50">
                                                    <i class="fas fa-edit"></i>
                                                </a>
                                                
                                                <% if (escola.ativa) { %>
                                                    <a href="/superadmin/escolas/<%= escola._id %>/inativar" title="Inativar" class="action-btn text-yellow-600 hover:text-yellow-800 hover:bg-yellow-50"
                                                        onclick="return confirm('Tem certeza que deseja INATIVAR esta escola?');">
                                                        <i class="fas fa-pause"></i>
                                                    </a>
                                                <% } else { %>
                                                    <a href="/superadmin/escolas/<%= escola._id %>/ativar" title="Ativar" class="action-btn text-green-600 hover:text-green-800 hover:bg-green-50"
                                                        onclick="return confirm('Tem certeza que deseja ATIVAR esta escola?');">
                                                        <i class="fas fa-play"></i>
                                                    </a>
                                                <% } %>

                                                <button type="button" 
                                                        onclick="confirmResetAdminPassword('<%= escola._id %>', '<%= escola.nome %>', '<%= escola.adminEmail %>');" 
                                                        title="Redefinir Senha do Admin" 
                                                        class="action-btn text-red-600 hover:text-red-800 hover:bg-red-50">
                                                    <i class="fas fa-key"></i>
                                                </button>
                                            </div>
                                        </td>
                                    </tr>
                                <% }) %>
                            </tbody>
                        </table>
                    </div>
                <% } else { %>
                    <div class="text-center py-12">
                        <i class="fas fa-school text-6xl text-gray-300 mb-4"></i>
                        <p class="text-gray-600 text-xl">Nenhuma escola cadastrada ainda.</p>
                    </div>
                <% } %>
            </div>

            <!-- Conteúdo da Aba: Gerenciar Solicitações -->
            <div id="solicitacoes-tab" class="tab-content <%= activeTab === 'solicitacoes' ? '' : 'hidden' %>">
                <h2 class="text-3xl font-bold text-gray-800 mb-6 flex items-center">
                    <i class="fas fa-envelope text-yellow-600 mr-3"></i>
                    Gerenciar Solicitações de Acesso
                </h2>
                
                <% if (typeof solicitacoes !== 'undefined' && solicitacoes.length > 0) { %>
                    <div class="overflow-x-auto">
                        <table class="modern-table">
                            <thead>
                                <tr>
                                    <th>Nome da Escola</th>
                                    <th>Admin Solicitante</th>
                                    <th>E-mail</th>
                                    <th>Data da Solicitação</th>
                                    <th class="text-center">Ações</th>
                                </tr>
                            </thead>
                            <tbody>
                                <% solicitacoes.forEach(solicitacao => { %>
                                    <tr>
                                        <td class="font-semibold text-gray-900"><%= solicitacao.nomeEscola %></td>
                                        <td><%= solicitacao.nomeResponsavel %></td>
                                        <td><%= solicitacao.emailContato %></td>
                                        <td><%= new Date(solicitacao.dataSolicitacao).toLocaleString('pt-BR', { timeZone: 'America/Sao_Paulo' }) %></td>
                                        <td class="text-center">
                                            <div class="flex items-center justify-center gap-2">
                                                <a href="/superadmin/solicitacoes/<%= solicitacao._id %>/editar" title="Ver Detalhes" class="action-btn text-blue-600 hover:text-blue-800 hover:bg-blue-50">
                                                    <i class="fas fa-eye"></i>
                                                </a>
                                                <form action="/superadmin/solicitacoes/<%= solicitacao._id %>/aprovar" method="POST" class="inline">
                                                    <button type="submit" title="Aprovar" class="action-btn text-green-600 hover:text-green-800 hover:bg-green-50"
                                                        onclick="return confirm('Tem certeza que deseja APROVAR esta solicitação? Uma nova senha será gerada para o admin.');">
                                                        <i class="fas fa-check"></i>
                                                    </button>
                                                </form>
                                                <form action="/superadmin/solicitacoes/<%= solicitacao._id %>/rejeitar" method="POST" class="inline">
                                                    <button type="submit" title="Rejeitar" class="action-btn text-red-600 hover:text-red-800 hover:bg-red-50"
                                                        onclick="return confirm('Tem certeza que deseja REJEITAR esta solicitação?');">
                                                        <i class="fas fa-times"></i>
                                                    </button>
                                                </form>
                                            </div>
                                        </td>
                                    </tr>
                                <% }) %>
                            </tbody>
                        </table>
                    </div>
                <% } else { %>
                    <div class="text-center py-12">
                        <i class="fas fa-envelope text-6xl text-gray-300 mb-4"></i>
                        <p class="text-gray-600 text-xl">Nenhuma solicitação de acesso pendente.</p>
                    </div>
                <% } %>
            </div>

            <!-- Conteúdo da Aba: Projetos Sem Avaliação -->
            <div id="projetos-sem-avaliacao-tab" class="tab-content <%= activeTab === 'projetos-sem-avaliacao' ? '' : 'hidden' %>">
                <h2 class="text-3xl font-bold text-gray-800 mb-6 flex items-center">
                    <i class="fas fa-clock text-red-600 mr-3"></i>
                    Projetos Pendentes de Avaliação
                </h2>
                
                <div class="mb-8 p-6 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl border border-blue-200">
                    <form action="/superadmin/dashboard" method="GET" class="flex items-center space-x-4">
                        <input type="hidden" name="tab" value="projetos-sem-avaliacao">
                        <label for="filterEscola" class="text-gray-700 font-semibold">Filtrar por Escola:</label>
                        <select id="filterEscola" name="escolaId" onchange="this.form.submit()" class="modern-select block w-auto px-4 py-3 text-gray-700 bg-white">
                            <option value="">-- Selecione uma Escola --</option>
                            <% if (typeof todasEscolas !== 'undefined' && todasEscolas.length > 0) { %>
                                <% todasEscolas.forEach(escola => { %>
                                    <option value="<%= escola._id %>" <%= selectedEscolaId === String(escola._id) ? 'selected' : '' %>>
                                        <%= escola.nome %>
                                    </option>
                                <% }) %>
                            <% } %>
                        </select>
                    </form>
                </div>

                <% if (typeof selectedEscolaId !== 'undefined' && selectedEscolaId) { %>
                    <% if (typeof projetosNaoAvaliados !== 'undefined' && projetosNaoAvaliados.length > 0) { %>
                        <div class="overflow-x-auto">
                            <table class="modern-table">
                                <thead>
                                    <tr>
                                        <th>Título do Projeto</th>
                                        <th>Turma</th>
                                        <th>Avaliadores Designados</th>
                                        <th class="text-center">Avaliações Recebidas</th>
                                        <th class="text-center">Critérios Necessários</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <% projetosNaoAvaliados.forEach(projeto => { %>
                                        <tr>
                                            <td class="font-semibold text-gray-900"><%= projeto.titulo %></td>
                                            <td><%= projeto.turma %></td>
                                            <td><%= projeto.avaliadoresDesignados %></td>
                                            <td class="text-center font-semibold"><%= projeto.numAvaliacoesRecebidas %></td>
                                            <td class="text-center font-semibold"><%= projeto.totalCriteriosNecessarios %></td>
                                        </tr>
                                    <% }) %>
                                </tbody>
                            </table>
                        </div>
                    <% } else { %>
                        <div class="text-center py-12">
                            <i class="fas fa-check-circle text-6xl text-green-400 mb-4"></i>
                            <p class="text-gray-600 text-xl">Todos os projetos desta escola foram avaliados ou não há projetos.</p>
                        </div>
                    <% } %>
                <% } else { %>
                    <div class="text-center py-12">
                        <i class="fas fa-arrow-up text-6xl text-gray-300 mb-4"></i>
                        <p class="text-gray-600 text-xl">Selecione uma escola acima para ver os projetos pendentes de avaliação.</p>
                    </div>
                <% } %>
            </div>

            <!-- Conteúdo da Aba: relatórios-->

            <div id="relatorio-projetos-tab" class="tab-content <%= activeTab === 'relatorio-projetos' ? '' : 'hidden' %> animate-fade-in-up">
    <h2 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
        <i class="fas fa-list-alt text-purple-600 mr-2"></i>
        Relatório de Projetos por Escola e Categoria
    </h2>

    <% if (projetosPorEscola && projetosPorEscola.length > 0) { %>
        <% projetosPorEscola.forEach(escola => { %>
            <div class="mb-6 p-3 bg-gradient-to-r from-indigo-50 to-purple-50 rounded-lg border border-indigo-200">
                <h3 class="text-lg font-bold text-gray-700 mb-3 flex items-center">
                    <i class="fas fa-school text-indigo-600 mr-2"></i>
                    Escola: <%= escola.escolaNome %>
                </h3>

                <% Object.keys(escola.categorias).forEach(categoria => { %>
                    <div class="mb-3">
                        <h4 class="text-base font-semibold text-gray-600 mb-2">
                            <i class="fas fa-folder-open text-purple-500 mr-2"></i>
                            Categoria: <%= categoria %>
                        </h4>

                        <div class="overflow-x-auto">
                            <table class="modern-table text-sm">
                                <thead>
                                    <tr>
                                        <th class="px-2 py-1">Título do Projeto</th>
                                        <th class="px-2 py-1">Turma</th>
                                        <th class="px-2 py-1">Nº Aval.</th>

                                        <% 
                                        // Pega o primeiro projeto para descobrir os critérios dinamicamente
                                        const primeiroProjeto = escola.categorias[categoria][0];
                                        const criteriosProjeto = primeiroProjeto && primeiroProjeto.mediasCriterios ? Object.keys(primeiroProjeto.mediasCriterios) : [];
                                        %>

                                        <% criteriosProjeto.forEach(critId => { %>
                                            <th class="px-2 py-1">Crit. <%= critId %></th>
                                        <% }) %>

                                        <th class="px-2 py-1">Média</th>
                                        <th class="px-2 py-1">Premiado</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <% escola.categorias[categoria].forEach(proj => { %>
                                        <tr>
                                            <td class="font-medium text-gray-900 px-2 py-1"><%= proj.titulo %></td>
                                            <td class="px-2 py-1"><%= proj.turma %></td>
                                            <td class="text-center px-2 py-1"><%= proj.numAvaliacoes %></td>

                                            <% criteriosProjeto.forEach(critId => { %>
                                                <td class="text-center px-2 py-1"><%= proj.mediasCriterios[critId] %></td>
                                            <% }) %>

                                            <td class="text-center font-medium px-2 py-1"><%= proj.mediaGeral %></td>
                                            <td class="text-center px-2 py-1"><%= proj.premiado %></td>
                                        </tr>
                                    <% }) %>
                                </tbody>
                            </table>
                        </div>
                    </div>
                <% }) %>
            </div>
        <% }) %>
    <% } else { %>
        <div class="text-center py-8">
            <i class="fas fa-info-circle text-4xl text-gray-300 mb-3"></i>
            <p class="text-gray-600 text-lg">Nenhum projeto encontrado.</p>
        </div>
    <% } %>
</div>

            <!-- Conteúdo da Aba: Ranking de Projetos por Categoria -->
            <div id="ranking-projetos-tab" class="tab-content <%= activeTab === 'ranking-projetos' ? '' : 'hidden' %>">
                <h2 class="text-3xl font-bold text-gray-800 mb-6 flex items-center">
                    <i class="fas fa-trophy text-yellow-600 mr-3"></i>
                    Ranking de Projetos por Categoria
                </h2>
                
                <% if (typeof rankingProjetosPorCategoria !== 'undefined' && Object.keys(rankingProjetosPorCategoria).length > 0) { %>
                    <% for (const categoriaNome in rankingProjetosPorCategoria) { %>
                        <% const projetosNaCategoria = rankingProjetosPorCategoria[categoriaNome]; %>
                        <div class="mb-10 p-6 bg-gradient-to-r from-purple-50 to-pink-50 rounded-xl border border-purple-200">
                            <h3 class="text-2xl font-bold text-gray-700 mb-6 flex items-center">
                                <i class="fas fa-medal text-purple-600 mr-3"></i>
                                Categoria: <%= categoriaNome %>
                            </h3>
                            <% if (projetosNaCategoria.length > 0) { %>
                                <div class="overflow-x-auto">
                                    <table class="modern-table">
                                        <thead>
                                            <tr>
                                                <th class="text-center">Posição</th>
                                                <th>Título do Projeto</th>
                                                <th class="text-center">Média Geral</th>
                                                <th class="text-center">Nº Avaliações</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <% projetosNaCategoria.forEach((projeto, index) => { %>
                                                <tr>
                                                    <td class="text-center">
                                                        <span class="inline-flex items-center justify-center w-8 h-8 rounded-full font-bold text-white 
                                                            <%= index === 0 ? 'bg-yellow-500' : index === 1 ? 'bg-gray-400' : index === 2 ? 'bg-yellow-600' : 'bg-gray-500' %>">
                                                            <%= index + 1 %>
                                                        </span>
                                                    </td>
                                                    <td class="font-semibold text-gray-900"><%= projeto.titulo %></td>
                                                    <td class="text-center">
                                                        <span class="modern-badge badge-success font-bold">
                                                            <i class="fas fa-star"></i><%= projeto.mediaGeral %>
                                                        </span>
                                                    </td>
                                                    <td class="text-center font-semibold"><%= projeto.numAvaliacoes %></td>
                                                </tr>
                                            <% }) %>
                                        </tbody>
                                    </table>
                                </div>
                            <% } else { %>
                                <div class="text-center py-8">
                                    <i class="fas fa-trophy text-4xl text-gray-300 mb-4"></i>
                                    <p class="text-gray-600">Nenhum projeto avaliado nesta categoria.</p>
                                </div>
                            <% } %>
                        </div>
                    <% } %>
                <% } else { %>
                    <div class="text-center py-12">
                        <i class="fas fa-trophy text-6xl text-gray-300 mb-4"></i>
                        <p class="text-gray-600 text-xl">Nenhum projeto avaliado para exibir o ranking.</p>
                    </div>
                <% } %>
            </div>

            <!-- Conteúdo da Aba: Resumo de Avaliadores por Escola -->
            <div id="resumo-avaliadores-tab" class="tab-content <%= activeTab === 'resumo-avaliadores' ? '' : 'hidden' %>">
                <h2 class="text-3xl font-bold text-gray-800 mb-6 flex items-center">
                    <i class="fas fa-users text-green-600 mr-3"></i>
                    Resumo de Avaliadores por Escola
                </h2>
                
                <% if (typeof resumoAvaliadoresPorEscola !== 'undefined' && resumoAvaliadoresPorEscola.length > 0) { %>
                    <% resumoAvaliadoresPorEscola.forEach(escolaInfo => { %>
                        <div class="mb-10 p-6 bg-gradient-to-r from-green-50 to-blue-50 rounded-xl border border-green-200">
                            <h3 class="text-2xl font-bold text-gray-700 mb-6 flex items-center">
                                <i class="fas fa-school text-green-600 mr-3"></i>
                                Escola: <%= escolaInfo.escolaNome %>
                            </h3>
                            <% if (escolaInfo.avaliadores && escolaInfo.avaliadores.length > 0) { %>
                                <div class="overflow-x-auto">
                                    <table class="modern-table">
                                        <thead>
                                            <tr>
                                                <th>Nome do Avaliador</th>
                                                <th>E-mail</th>
                                                <th class="text-center">Status</th>
                                                <th class="text-center">Projetos Atribuídos</th>
                                                <th class="text-center">Projetos Avaliados</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <% escolaInfo.avaliadores.forEach(avaliador => { %>
                                                <tr>
                                                    <td class="font-semibold text-gray-900"><%= avaliador.nome %></td>
                                                    <td><%= avaliador.email %></td>
                                                    <td class="text-center">
                                                        <span class="modern-badge <%= avaliador.status === 'Ativo' ? 'badge-success' : 'badge-danger' %>">
                                                            <i class="fas fa-<%= avaliador.status === 'Ativo' ? 'check-circle' : 'times-circle' %>"></i>
                                                            <%= avaliador.status %>
                                                        </span>
                                                    </td>
                                                    <td class="text-center font-semibold"><%= avaliador.totalAtribuidos %></td>
                                                    <td class="text-center font-semibold"><%= avaliador.totalAvaliados %></td>
                                                </tr>
                                            <% }) %>
                                        </tbody>
                                    </table>
                                </div>
                            <% } else { %>
                                <div class="text-center py-8">
                                    <i class="fas fa-users text-4xl text-gray-300 mb-4"></i>
                                    <p class="text-gray-600">Nenhum avaliador cadastrado para esta escola.</p>
                                </div>
                            <% } %>
                        </div>
                    <% }) %>
                <% } else { %>
                    <div class="text-center py-12">
                        <i class="fas fa-users text-6xl text-gray-300 mb-4"></i>
                        <p class="text-gray-600 text-xl">Nenhuma escola com avaliadores para exibir o resumo.</p>
                    </div>
                <% } %>
            </div>
        </div>
    </main>

    <!-- Modal para Confirmação de Redefinição de Senha -->
    <div id="resetAdminPasswordModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 modern-modal hidden flex items-center justify-center z-50 p-4">
        <div class="bg-white rounded-xl shadow-2xl p-8 w-full max-w-md modal-content-modern">
            <div class="text-center mb-6">
                <div class="mx-auto flex items-center justify-center h-16 w-16 rounded-full bg-red-100 mb-4">
                    <i class="fas fa-key text-red-600 text-2xl"></i>
                </div>
                <h3 class="text-2xl font-bold text-gray-800 mb-2">Redefinir Senha do Admin</h3>
            </div>
            <div class="text-center mb-6">
                <p class="text-gray-700 mb-4">Tem certeza que deseja redefinir a senha do administrador principal da escola <strong id="escolaNomeReset" class="text-blue-600"></strong>?</p>
                <p class="text-sm text-gray-600 bg-yellow-50 p-3 rounded-lg border border-yellow-200">
                    <i class="fas fa-exclamation-triangle text-yellow-600 mr-2"></i>
                    Uma nova senha provisória será gerada e exibida para você. Você deve passá-la ao administrador.
                </p>
                <p class="text-sm text-gray-500 mt-2">Email: <span id="adminEmailReset" class="font-semibold"></span></p>
            </div>
            <div class="flex justify-center gap-4">
                <button type="button" onclick="closeResetAdminPasswordModal();" class="px-6 py-3 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors font-semibold">
                    <i class="fas fa-times mr-2"></i>Cancelar
                </button>
                <form id="resetAdminPasswordForm" method="POST" class="inline">
                    <input type="hidden" name="_method" value="POST">
                    <button type="submit" class="px-6 py-3 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors font-semibold">
                        <i class="fas fa-key mr-2"></i>Redefinir Senha
                    </button>
                </form>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const urlParams = new URLSearchParams(window.location.search);
            const initialTab = urlParams.get('tab') || '<%= activeTab %>' || 'visao-geral';
            activateTab(initialTab);

            document.querySelectorAll('.tab-button').forEach(button => {
                button.addEventListener('click', function (e) {
                    e.preventDefault();
                    const tabName = this.getAttribute('data-tab');
                    window.location.href = `/superadmin/dashboard?tab=${tabName}`;
                });
            });
        });

        function activateTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.add('hidden'));
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));

            const activeTabContent = document.getElementById(`${tabName}-tab`);
            if (activeTabContent) activeTabContent.classList.remove('hidden');

            const activeButton = document.querySelector(`.tab-button[data-tab="${tabName}"]`);
            if (activeButton) activeButton.classList.add('active');
        }

        function confirmResetAdminPassword(escolaId, escolaNome, adminEmail) {
            document.getElementById('escolaNomeReset').textContent = escolaNome;
            document.getElementById('adminEmailReset').textContent = adminEmail;
            document.getElementById('resetAdminPasswordForm').action = `/superadmin/escolas/${escolaId}/reset-password`;
            document.getElementById('resetAdminPasswordModal').classList.remove('hidden');
        }

        function closeResetAdminPasswordModal() {
            document.getElementById('resetAdminPasswordModal').classList.add('hidden');
        }

        // Fechar modal clicando fora dele
        document.getElementById('resetAdminPasswordModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeResetAdminPasswordModal();
            }
        });
    </script>
</body>
</html>