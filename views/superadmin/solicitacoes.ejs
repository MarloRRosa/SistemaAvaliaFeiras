<!--solicitacoes.ejs-->
<div class="p-6 md:p-8 bg-gray-50 min-h-screen">
  <div class="max-w-7xl mx-auto bg-white rounded-xl shadow-md p-6">
    <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6">
      <h2 class="text-3xl font-bold text-gray-800 mb-4 md:mb-0">Gerenciar Solicitações de Acesso</h2>
    </div>

    <!-- Mensagens Flash -->
    <% if (success_msg) { %>
      <div class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded-lg mb-4">
        <span class="block sm:inline"><%- success_msg %></span>
      </div>
    <% } %>
    <% if (error_msg) { %>
      <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg mb-4">
        <span class="block sm:inline"><%- error_msg %></span>
      </div>
    <% } %>

    <% if (solicitacoes.length > 0) { %>
      <div class="overflow-x-auto bg-white rounded-lg shadow-md">
        <table class="min-w-full text-sm text-left text-gray-700 divide-y divide-gray-200">
          <thead class="text-xs uppercase bg-gray-100 text-gray-600">
            <tr>
              <th class="px-4 py-3">Escola</th>
              <th class="px-4 py-3">Responsável</th>
              <th class="px-4 py-3">Contato</th>
              <th class="px-4 py-3">Evento</th>
              <th class="px-4 py-3">Status</th>
              <th class="px-4 py-3 text-center">Ações</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-gray-200">
            <% solicitacoes.forEach(s => { %>
              <tr class="hover:bg-gray-50 transition">
                <td class="px-4 py-4 text-gray-900">
                  <strong><%= s.nomeEscola %></strong>
                  <p class="text-xs text-gray-500">CNPJ: <%= s.cnpj || 'Não Informado' %></p>
                  <p class="text-xs text-gray-500">Endereço: <%= s.endereco %></p>
                  <p class="text-xs text-gray-500">Tel. Escola: <%= s.telefoneEscola %></p>
                </td>
                <td class="px-4 py-4">
                  <%= s.nomeResponsavel %>
                  <p class="text-xs text-gray-500">Cargo: <%= s.cargoResponsavel %></p>
                  <p class="text-xs text-gray-500">Tel: <%= s.telefoneContato %></p>
                </td>
                <td class="px-4 py-4">
  <%= s.emailContato %>
  <p class="text-xs text-gray-500">Solicitado em: <%= new Date(s.dataSolicitacao).toLocaleString('pt-BR') %></p>

  <% if (s.registroAceite) { %>
    <p class="text-xs text-gray-500 italic">
      Termo aceito: <%= s.registroAceite.aceite ? 'Sim' : 'Não' %>
    </p>
    <p class="text-xs text-gray-400 italic">
      IP: <%= s.registroAceite.ip || 'N/A' %>
    </p>
    <p class="text-xs text-gray-400 italic">
      Aceito em: <%= s.registroAceite.dataHora ? new Date(s.registroAceite.dataHora).toLocaleString('pt-BR') : 'N/A' %>
    </p>
  <% } else { %>
    <p class="text-xs text-red-400 italic">⚠️ Dados de aceite não registrados</p>
  <% } %>
</td>

                <td class="px-4 py-4">
                  <%= s.tipoEvento %>
                  <p class="text-xs text-gray-500">Previsão: <%= s.previsaoUso || 'N/A' %></p>
                  <% if (s.mensagem) { %>
                    <p class="text-xs text-gray-500 italic">"<%= s.mensagem %>"</p>
                  <% } %>
                </td>
                <td class="px-4 py-4">
                  <% if (s.status === 'Pendente') { %>
                    <span class="px-2 py-1 text-xs font-medium bg-yellow-100 text-yellow-800 rounded-full">Pendente</span>
                  <% } else { %>
                    <span class="px-2 py-1 text-xs font-medium bg-gray-100 text-gray-700 rounded-full"><%= s.status %></span>
                  <% } %>
                </td>
                <td class="px-4 py-4 text-center flex items-center justify-center gap-3">
                  <a href="/superadmin/solicitacoes/<%= s._id %>/editar" title="Ver Detalhes" class="text-blue-600 hover:text-blue-800">
                    <i class="fas fa-eye"></i>
                  </a>
                  <% if (s.status === 'Pendente') { %>
                    <form action="/superadmin/solicitacoes/<%= s._id %>/aprovar" method="POST" onsubmit="return confirm('Deseja APROVAR esta solicitação?');" class="inline">
                      <button title="Aprovar" class="text-green-600 hover:text-green-800"><i class="fas fa-check-circle"></i></button>
                    </form>
                    <form action="/superadmin/solicitacoes/<%= s._id %>/rejeitar" method="POST" onsubmit="return confirm('Deseja REJEITAR esta solicitação?');" class="inline">
                      <button title="Rejeitar" class="text-red-600 hover:text-red-800"><i class="fas fa-times-circle"></i></button>
                    </form>
                  <% } %>
                </td>
              </tr>
            <% }) %>
          </tbody>
        </table>
      </div>
    <% } else { %>
      <p class="text-center text-gray-600 mt-10 text-lg">Nenhuma solicitação pendente.</p>
    <% } %>

    <div class="text-center mt-8">
      <a href="/superadmin/dashboard" class="text-blue-600 hover:text-blue-800 hover:underline">
        ← Voltar para o Painel Principal
      </a>
    </div>
  </div>
</div>
