

<div class="bg-white p-6 rounded-lg shadow-xl mb-6">
    <h2 class="text-2xl font-semibold mb-4 text-gray-700" id="formAvaliadorTitulo">Novo Avaliador</h2>
    <form id="formAvaliador" method="POST" action="/admin/avaliadores">
        <input type="hidden" id="avaliadorId" name="id">
        <div class="mb-4">
            <label for="nome" class="block text-gray-700 text-sm font-bold mb-2">Nome do Avaliador:</label>
            <input type="text" id="nome" name="nome" required class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
        </div>

        <div class="mb-4">
            <label for="pin" class="block text-gray-700 text-sm font-bold mb-2">PIN:</label>
            <input type="text" id="pin" name="pin" required maxlength="6" minlength="4" pattern="[0-9]*" title="Apenas números são permitidos (4 a 6 dígitos)"
                   class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
        </div>

        <div class="mb-4 flex items-center">
            <input type="checkbox" id="ativo" name="ativo" value="true" checked class="mr-2 h-4 w-4 text-yellow-600 focus:ring-yellow-500 border-gray-300 rounded">
            <label for="ativo" class="text-gray-700 text-sm font-bold">Avaliador Ativo</label>
        </div>

        <div class="flex justify-end gap-2 mt-4">
            <button type="submit" class="bg-yellow-500 text-white px-4 py-2 rounded hover:bg-yellow-600">Salvar Avaliador</button>
            <button type="button" id="btnLimparForm" class="bg-gray-300 text-gray-800 px-4 py-2 rounded hover:bg-gray-400">Limpar Formulário</button>
        </div>
    </form>
</div>

<div class="bg-white p-6 rounded-lg shadow-xl">
    <h3 class="text-2xl font-semibold mb-4 text-gray-700">Lista de Avaliadores da Escola</h3>
    <% if (avaliadores.length === 0) { %>
        <p class="text-gray-600">Nenhum avaliador cadastrado ainda para esta escola.</p>
    <% } else { %>
        <table class="min-w-full text-sm bg-white shadow rounded">
            <thead class="bg-gray-100 text-left">
                <tr>
                    <th class="px-4 py-2">Nome</th>
                    <th class="px-4 py-2">PIN</th>
                    <th class="px-4 py-2">Status</th>
                    <th class="px-4 py-2">Ações</th>
                </tr>
            </thead>
            <tbody>
                <% avaliadores.forEach(avaliador => { %>
                <tr class="border-t">
                    <td class="px-4 py-2"><%= avaliador.nome %></td>
                    <td class="px-4 py-2"><%= avaliador.pin %></td>
                    <td class="px-4 py-2">
                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full <%= avaliador.ativo ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800' %>">
                            <%= avaliador.ativo ? 'Ativo' : 'Inativo' %>
                        </span>
                    </td>
                    <td class="px-4 py-2 space-x-2">
                        <button class="btn-editar-avaliador text-blue-600 hover:underline"
                                data-id="<%= avaliador._id %>"
                                data-nome="<%= avaliador.nome %>"
                                data-pin="<%= avaliador.pin %>"
                                data-ativo="<%= avaliador.ativo %>">
                            Editar
                        </button>
                        <form method="POST" action="/admin/avaliadores/<%= avaliador._id %>/excluir" class="inline" onsubmit="return confirm('Deseja excluir este avaliador e todas as suas avaliações?');">
                            <button type="submit" class="text-red-600 hover:underline">Excluir</button>
                        </form>
                         <a href="/admin/avaliadores/<%= avaliador._id %>/atribuir-projetos" class="text-purple-600 hover:underline">Atribuir Projetos</a>
                    </td>
                </tr>
                <% }) %>
            </tbody>
        </table>
    <% } %>
</div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const formAvaliador = document.getElementById('formAvaliador');
        const avaliadorId = document.getElementById('avaliadorId');
        const nomeInput = document.getElementById('nome');
        const pinInput = document.getElementById('pin');
        const ativoCheckbox = document.getElementById('ativo');
        const formAvaliadorTitulo = document.getElementById('formAvaliadorTitulo');
        const btnLimparForm = document.getElementById('btnLimparForm');

        document.querySelectorAll('.btn-editar-avaliador').forEach(button => {
            button.addEventListener('click', () => {
                avaliadorId.value = button.dataset.id;
                nomeInput.value = button.dataset.nome;
                pinInput.value = button.dataset.pin;
                ativoCheckbox.checked = button.dataset.ativo === 'true'; // Setar checkbox
                formAvaliadorTitulo.innerText = 'Editar Avaliador';
            });
        });

        btnLimparForm.addEventListener('click', () => {
            formAvaliador.reset();
            avaliadorId.value = '';
            formAvaliadorTitulo.innerText = 'Novo Avaliador';
            ativoCheckbox.checked = true; // Garante que começa ativo ao limpar
        });
    });
</script>