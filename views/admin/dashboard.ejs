<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title><%= titulo %></title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <link rel="stylesheet" href="/css/admin-custom.css">
  
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
      @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes slideIn {
            from { transform: translateX(-20px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        .animate-fade-in {
            animation: fadeIn 0.3s ease-out;
        }
        
        .animate-slide-in {
            animation: slideIn 0.3s ease-out;
        }

        .btn-hover-effect {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        
        .btn-hover-effect::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }
        
        .btn-hover-effect:hover::before {
            left: 100%;
        }
        
        .btn-hover-effect:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        }
        
        .table-responsive {
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        
        .table-row-hover {
            transition: all 0.2s ease;
        }
        
        .table-row-hover:hover {
            background-color: #f8fafc;
            transform: translateX(2px);
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .badge-animate {
            transition: all 0.2s ease;
        }
        
        .badge-animate:hover {
            transform: scale(1.05);
        }

        .modal-backdrop {
            backdrop-filter: blur(4px);
            background-color: rgba(0, 0, 0, 0.6);
        }
        
        .modal-content {
            animation: fadeIn 0.3s ease-out;
        }
        
        .subtab-btn {
            position: relative;
            padding: 12px 20px;
            border-radius: 8px;
            transition: all 0.2s ease;
            font-weight: 600;
        }
        
        .subtab-btn.active {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            color: white;
            box-shadow: 0 4px 6px rgba(59, 130, 246, 0.3);
        }
        
        .subtab-btn:not(.active):hover {
            background-color: #f1f5f9;
            color: #1e40af;
        }
        
        .tooltip {
            position: relative;
        }
        
        .tooltip::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: #1f2937;
            color: white;
            padding: 6px 10px;
            border-radius: 6px;
            font-size: 12px;
            white-space: nowrap;
            opacity: 0;
            visibility: hidden;
            transition: all 0.2s ease;
            z-index: 1000;
        }
        
        .tooltip:hover::after {
            opacity: 1;
            visibility: visible;
            bottom: calc(100% + 5px);
        }
        
        .search-input {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%236b7280'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: 12px center;
            background-size: 18px;
            padding-left: 40px;
        }
        
        .status-indicator {
            position: relative;
            display: inline-flex;
            align-items: center;
        }
        
        .status-indicator::before {
            content: '';
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 8px;
            animation: pulse 2s infinite;
        }
        
        .status-active::before {
            background-color: #10b981;
        }
        
        .status-inactive::before {
            background-color: #ef4444;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        @media (max-width: 768px) {
            .table-responsive {
                font-size: 14px;
            }
            
            .btn-hover-effect {
                padding: 8px 12px;
                font-size: 14px;
            }
        }

    #projetosAvaliador, #criteriosProjeto {
      max-height: 200px;
      overflow-y: auto;
      border-radius: 0.375rem;
      border-color: #d1d5db;
    }
    .modal-full {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      z-index: 100;
      background-color: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      transition: opacity 0.3s ease-in-out;
    }
    .modal-full.hidden {
      opacity: 0;
      pointer-events: none; 
    }
    .modal-full:not(.hidden) {
      opacity: 1;
      pointer-events: auto;
    }
  </style>
</head>
<body class="bg-gray-50 min-h-screen">
  <div id="overlay" class="fixed inset-0 bg-black bg-opacity-50 hidden z-40" onclick="fecharSidebar()"></div>

  <button id="sidebarToggle" class="fixed top-4 left-4 z-50 p-2 bg-blue-600 text-white rounded-md shadow-md">
    <i class="fas fa-bars"></i>
  </button>

    <%
        // Inicialização de variáveis para evitar 'is not defined'
        if (!feiras) { feiras = []; }
        if (!feiraAtual) { feiraAtual = {}; }
        if (!projetos) { projetos = []; }
        if (!categorias) { categorias = []; }
        if (!criterios) { criterios = []; } 
        if (!avaliadores) { avaliadores = []; }
        if (!avaliacoes) { avaliacoes = []; }
        if (!escolas) { escolas = []; }
        if (!totalProjetos) { totalProjetos = 0; }
        if (!totalAvaliadores) { totalAvaliadores = 0; }
        if (!projetosAvaliadosCompletosCount) { projetosAvaliadosCompletosCount = 0; }
        if (!projetosPendentesAvaliacaoCount) { projetosPendentesAvaliacaoCount = 0; }
        if (!mediaGeralAvaliacoes) { mediaGeralAvaliacoes = 'N/A'; }
        if (!projetosPorCategoria) { projetosPorCategoria = {}; }
        if (!relatorioFinalPorProjeto) { relatorioFinalPorProjeto = {}; }
    %>

    <!-- Sidebar -->
    <aside id="sidebar" class="fixed top-0 left-0 h-full w-64 bg-gray-800 text-gray-100 transform -translate-x-full transition-transform duration-300 z-50">
  <div class="p-4 text-center border-b border-gray-700 mb-4 flex justify-between items-center">
    <h1 class="text-2xl font-extrabold tracking-tight text-white link-text">Painel Admin</h1>
  </div>

  <nav class="flex-grow">
    <ul class="space-y-1">
      <li>
        <a href="#" class="sidebar-link <% if(activeTab === 'dashboard-geral') { %>active<% } %>" data-tab="dashboard-geral">
          <span class="icon-wrapper"><i class="fas fa-tachometer-alt"></i></span>
          <span class="link-text">Visão Geral</span>
        </a>
      </li>
      <li>
        <a href="#" class="sidebar-link <% if(activeTab === 'projetos') { %>active<% } %>" data-tab="projetos">
          <span class="icon-wrapper"><i class="fas fa-lightbulb"></i></span>
          <span class="link-text">Projetos</span>
        </a>
      </li>
      <li>
        <a href="#" class="sidebar-link <% if(activeTab === 'categorias') { %>active<% } %>" data-tab="categorias">
          <span class="icon-wrapper"><i class="fas fa-tags"></i></span>
          <span class="link-text">Categorias</span>
        </a>
      </li>
      <li>
        <a href="#" class="sidebar-link <% if(activeTab === 'criterios') { %>active<% } %>" data-tab="criterios">
          <span class="icon-wrapper"><i class="fas fa-clipboard-list"></i></span>
          <span class="link-text">Critérios</span>
        </a>
      </li>
      <li>
        <a href="#" class="sidebar-link <% if(activeTab === 'avaliadores') { %>active<% } %>" data-tab="avaliadores">
          <span class="icon-wrapper"><i class="fas fa-user-tie"></i></span>
          <span class="link-text">Avaliadores</span>
        </a>
      </li>
      <li>
        <a href="#" class="sidebar-link <% if(activeTab === 'feiras') { %>active<% } %>" data-tab="feiras">
          <span class="icon-wrapper"><i class="fas fa-calendar-alt"></i></span>
          <span class="link-text">Feiras</span>
        </a>
      </li>
      <li>
        <a href="#" class="sidebar-link <% if(activeTab === 'relatorios') { %>active<% } %>" data-tab="relatorios">
          <span class="icon-wrapper"><i class="fas fa-file-pdf"></i></span>
          <span class="link-text">Relatórios</span>
        </a>
      </li>
      <!--<li>
        <a href="#" class="sidebar-link <% if(activeTab === 'tab-suporte') { %>active<% } %>" data-tab="tab-suporte">
          <span class="icon-wrapper"><i class="fas fa-comments"></i></span>
          <span class="link-text">Mensagens</span>
        </a>
      </li>-->
      <li>
        <a href="#" class="sidebar-link <% if(activeTab === 'tab-configuracoes') { %>active<% } %>" data-tab="tab-configuracoes">
          <span class="icon-wrapper"><i class="fas fa-cog"></i></span>
          <span class="link-text">Configurações</span>
        </a>
      </li>
    </ul>
  </nav>

  <div class="mt-auto pt-4 border-t border-gray-700">
    <form action="/admin/logout" method="POST" class="w-full">
      <button type="submit" class="w-full bg-red-700 hover:bg-red-800 text-white font-semibold py-2 px-4 rounded-lg shadow-md transition duration-300 ease-in-out">
        <span class="icon-wrapper"><i class="fas fa-sign-out-alt"></i></span>
        <span class="link-text">Sair</span>
      </button>
    </form>
  </div>
</aside>

    <!-- Main Content Area -->
    <div id="contentArea" class="p-6">
        <header class="bg-white p-4 shadow-md rounded-lg mb-6">
            <div class="container mx-auto flex justify-between items-center">
                <h2 class="text-3xl font-extrabold text-gray-800">
                    Feira Atual: <span class="text-blue-600"><%= feiraAtual.nome || 'Nenhuma Feira Ativa' %></span>
                    <small class="text-gray-500 text-lg ml-2">
                        (<%= feiraAtual.status ? (feiraAtual.status === 'ativa' ? 'Ativa' : 'Arquivada') : 'Não Definida' %>)
                        <%= feiraAtual.inicioFeira && feiraAtual.fimFeira ? ` (${new Date(feiraAtual.inicioFeira).toLocaleDateString('pt-BR')} - ${new Date(feiraAtual.fimFeira).toLocaleDateString('pt-BR')})` : '' %>
                    </small>
                </h2>
            </div>
        </header>

        <div class="mb-6 bg-white p-4 rounded-lg shadow-sm border border-gray-200">
            <form method="GET" action="/admin/dashboard" class="flex flex-wrap items-center gap-4">
                <label for="feiraSelecionada" class="text-base font-medium text-gray-700">Selecionar Feira:</label>
                <select name="feiraId" id="feiraSelecionada" class="...">
                        <% feiras.forEach(f => { %>
                        <option value="<%= f._id %>" <%= feiraAtual._id && feiraAtual._id.toString() === f._id.toString() ? 'selected' : '' %>>
                        <%= f.nome %> - <%= f.status === 'arquivada' ? 'Arquivada' : 'Ativa' %>
                     </option>
                         <% }) %>
                </select>
                <button type="submit" class="bg-blue-600 text-white px-5 py-2 rounded-lg hover:bg-blue-700 transition duration-300 ease-in-out shadow-md w-full md:w-auto">
                    <i class="fas fa-sync-alt mr-2"></i>Carregar
                </button>
            </form>
        </div>

   <div class="tab-content p-6 bg-white rounded-lg shadow-inner border border-gray-200 <%= activeTab !== 'dashboard-geral' ? 'hidden' : '' %>" id="dashboard-geral">
    <%- include('dashboard-geral-content', {
        projetosPorCategoria: projetosPorCategoria,
        avaliadores: avaliadores,
        relatorioFinalPorProjeto: relatorioFinalPorProjeto,
        criteriosOficiais: criterios,
        formatarData: formatarDatasParaInput
    }) %>
</div>
           
            <!-- ABA: PROJETOS -->
            <div class="tab-content p-6 bg-white rounded-lg shadow-inner border border-gray-200 hidden" id="projetos" role="tabpanel" aria-labelledby="projetos-tab">
                <button id="btnAbrirModalProjeto" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-5 rounded-lg mb-6 shadow-md transition duration-300 ease-in-out">
                    <i class="fas fa-plus-circle mr-2"></i>Adicionar Novo Projeto
                </button>

                <div class="overflow-x-auto bg-white rounded-lg shadow-md border border-gray-200">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-100">
                            <tr>
                                <th class="py-3 px-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Título</th>
                                <th class="py-3 px-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Turma</th>
                                <th class="py-3 px-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Ações</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200">
                            <% Object.keys(projetosPorCategoria).sort().forEach(nomeCategoria => { %>
                                <tr class="bg-gray-50">
                                    <td colspan="3" class="py-2 px-4 text-left font-extrabold text-lg text-blue-700">
                                        <%= nomeCategoria %>
                                    </td>
                                </tr>
                                <% projetosPorCategoria[nomeCategoria].forEach(projeto => { %>
                                    <tr class="hover:bg-gray-100 transition duration-150 ease-in-out">
                                        <td class="py-3 px-4 text-gray-800"><%= projeto.titulo %></td>
                                        <td class="py-3 px-4 text-gray-800"><%= projeto.turma || 'Não informado' %></td>
                                        <td class="py-3 px-4 whitespace-nowrap">
                                            <button 
  class="btn-editar-projeto bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-1.5 px-3 rounded-md text-sm mr-2 shadow-sm transition duration-300 ease-in-out"
  data-id="<%= projeto._id %>"
  data-titulo="<%= projeto.titulo %>"
  data-descricao="<%= projeto.descricao %>"
  data-categoria-id="<%= projeto.categoria ? projeto.categoria._id : '' %>"
  data-criterios="<%= projeto.criterios && projeto.criterios.length > 0 ? projeto.criterios.map(c => c._id).join(',') : '' %>"
  data-turma="<%= projeto.turma %>"
  data-alunos="<%= projeto.alunos.join(',') %>"
  data-relatorio-pdf="<%= projeto.relatorioPdf || '' %>"
  data-orientador="<%= projeto.orientador || '' %>"
  data-coorientador="<%= projeto.coorientador || '' %>"
>
  <i class="fas fa-edit mr-1"></i>Editar
</button>

             
                                            <form method="POST" action="/admin/projetos/<%= projeto._id %>?_method=DELETE" class="inline-block" onsubmit="return confirm('Tem certeza que deseja deletar este projeto?');">
                                                <input type="hidden"  name="_method" value="DELETE">
                                                <button type="submit" class="bg-red-600 hover:bg-red-700 text-white font-bold py-1.5 px-3 rounded-md text-sm shadow-sm transition duration-300 ease-in-out">Deletar</button>
                                            </form>
                                        </td>
                                    </tr>
                                <% }) %>
                            <% }) %>
                        </tbody>
                    </table>
                </div>
            </div>
            <!-- FIM ABA: PROJETOS -->

            <!-- ABA: CATEGORIAS -->
            <div class="tab-content p-6 bg-white rounded-lg shadow-inner border border-gray-200 hidden" id="categorias" role="tabpanel" aria-labelledby="categorias-tab">
                <button id="btnAbrirModalCategoria" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-5 rounded-lg mb-6 shadow-md transition duration-300 ease-in-out">
                    <i class="fas fa-plus-circle mr-2"></i>Adicionar Nova Categoria
                </button>

                <div class="overflow-x-auto bg-white rounded-lg shadow-md border border-gray-200">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-100">
                            <tr>
                                <th class="py-3 px-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Nome da Categoria</th>
                                <th class="py-3 px-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Ações</th>
                            </tr>
                        </thead>
                        <tbody>
                            <% categorias.forEach(categoria => { %>
                                <tr class="hover:bg-gray-100 transition duration-150 ease-in-out">
                                    <td class="py-3 px-4 text-gray-800"><%= categoria.nome %></td>
                                    <td class="py-3 px-4 whitespace-nowrap">
                                        <button class="btn-editar-categoria bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-1.5 px-3 rounded-md text-sm mr-2 shadow-sm transition duration-300 ease-in-out"
                                                data-id="<%= categoria._id %>" 
                                                data-nome="<%= categoria.nome %>">
                                            <i class="fas fa-edit mr-1"></i> Editar
                                        </button>
                                        <form method="POST" action="/admin/categorias/<%= categoria._id %>/excluir?_method=DELETE" class="inline-block" onsubmit="return confirm('Tem certeza que deseja deletar esta categoria?');">
                                            <input type="hidden" name="_method" value="DELETE">
                                            <button type="submit"  class="bg-red-600 hover:bg-red-700 text-white font-bold py-1.5 px-3 rounded-md text-sm shadow-sm transition duration-300 ease-in-out">
                                                <i class="fas fa-trash-alt mr-1"></i>Excluir
                                            </button>
                                        </form>
                                    </td>
                                </tr>
                            <% }) %>
                        </tbody>
                    </table>
                </div>
            </div>
            <!-- FIM ABA: CATEGORIAS -->

            <!-- ABA: CRITÉRIOS -->
            <div class="tab-content p-6 bg-white rounded-lg shadow-inner border border-gray-200 hidden" id="criterios" role="tabpanel" aria-labelledby="criterios-tab">
                <button id="btnAbrirModalCriterio" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-5 rounded-lg mb-6 shadow-md transition duration-300 ease-in-out">
                    <i class="fas fa-plus-circle mr-2"></i>Adicionar Novo Critério
                </button>

                <div class="overflow-x-auto bg-white rounded-lg shadow-md border border-gray-200">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-100">
                            <tr>
                                <th class="py-3 px-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Nome do Critério</th>
                                <th class="py-3 px-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Peso</th>
                                <th class="py-3 px-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Observações</th>
                                <th class="py-3 px-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Desempate (opcional)</th>
                                <th class="py-3 px-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Ações</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200">
                            <% criterios.forEach(criterio => { %>
                                <tr class="hover:bg-gray-100 transition duration-150 ease-in-out">
                                    <td class="py-3 px-4 text-gray-800"><%= criterio.nome %></td>
                                    <td class="py-3 px-4 text-gray-800"><%= criterio.peso %></td>
                                    <td class="py-3 px-4 text-gray-800"><%= criterio.observacao || 'Nenhuma' %></td>
                                    <td class="py-3 px-4 text-gray-800">
    <% if (criterio.ordemDesempate && criterio.ordemDesempate > 0) { %>
        <%= criterio.ordemDesempate %><sup>º</sup>
    <% } else { %>
        <span class="text-gray-400 italic">Ignorado</span>
    <% } %>
</td>

                                    <td class="py-3 px-4 whitespace-nowrap">
                                        <button class="btn-editar-criterio bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-1.5 px-3 rounded-md text-sm mr-2 shadow-sm transition duration-300 ease-in-out"
    data-id="<%= criterio._id %>"
    data-nome="<%= criterio.nome %>"
    data-peso="<%= criterio.peso %>"
    data-observacao="<%= criterio.observacao || '' %>"
    data-ordem="<%= criterio.ordemDesempate || 0 %>">
    <i class="fas fa-edit mr-1"></i>Editar
</button>
                                   
                                        <form method="POST" action="/admin/criterios/<%= criterio._id %>/excluir?_method=DELETE" class="inline-block" onsubmit="return confirm('Tem certeza que deseja deletar este critério?');">
                                            <input type="hidden"  name="_method" value="DELETE">
                                            <button type="submit"  class="bg-red-600 hover:bg-red-700 text-white font-bold py-1.5 px-3 rounded-md text-sm shadow-sm transition duration-300 ease-in-out">
                                                <i class="fas fa-trash-alt mr-1"></i>Excluir
                                            </button>
                                        </form>
                                    </td>
                                </tr>
                            <% }) %>
                        </tbody>
                    </table>
                </div>
            </div>
            <!-- FIM ABA: CRITÉRIOS -->

         <!-- ABA: AVALIADORES -->
 <div class="tab-content p-6 bg-white rounded-lg shadow-inner border border-gray-200" id="avaliadores" role="tabpanel" aria-labelledby="avaliadores-tab">
        
    <!-- Header -->
    <div class="mb-6 bg-gradient-to-r from-blue-50 to-indigo-50 p-4 rounded-lg border border-blue-100">
        <div class="flex flex-wrap items-center justify-between gap-4">
            <div>
                <h2 class="text-xl font-bold text-gray-800 mb-1">Gerenciamento de Avaliadores</h2>
                <p class="text-sm text-gray-600">Gerencie avaliadores, pré-cadastros e configurações do sistema</p>
            </div>
        </div>
    </div>

    <!-- Botões principais -->
    <div class="flex flex-wrap items-center gap-3 mb-6">
        <button id="btnAbrirModalAvaliador" class="btn-hover-effect bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white font-semibold py-2.5 px-5 rounded-lg shadow-md">
            <i class="fas fa-plus-circle mr-2"></i>Adicionar Novo Avaliador
        </button>
        <button onclick="copiarLinkPreCadastro()" class="btn-hover-effect bg-gradient-to-r from-indigo-600 to-indigo-700 hover:from-indigo-700 hover:to-indigo-800 text-white font-semibold py-2.5 px-5 rounded-lg shadow-md">
            <i class="fas fa-link mr-2"></i>Copiar Link de Pré-Cadastro
        </button>
        <a href="/admin/formulario-pre-cadastro/configurar" class="btn-hover-effect bg-gradient-to-r from-yellow-500 to-yellow-600 hover:from-yellow-600 hover:to-yellow-700 text-white font-semibold py-2.5 px-5 rounded-lg shadow-md">
            <i class="fas fa-edit mr-2"></i>Ver e Editar Formulário
        </a>
    </div>

    <!-- Subabas -->
    <div class="flex gap-2 mb-6 bg-gray-100 p-1 rounded-lg">
        <button class="subtab-btn active flex-1 text-sm transition-all duration-200" data-subtab="sub-avaliadores-cadastrados">
            <i class="fas fa-users mr-2"></i>Cadastrados
        </button>
        <button class="subtab-btn flex-1 text-sm text-gray-600 hover:text-blue-600 transition-all duration-200" data-subtab="sub-pre-cadastros">
            <i class="fas fa-clock mr-2"></i>Pré-Cadastros Pendentes
        </button>
    </div>

    <!-- Conteúdo: Avaliadores Cadastrados -->
    <div id="sub-avaliadores-cadastrados" class="subtab-content block">
        
        <!-- Botão para reenviar múltiplos -->
<div class="flex justify-end mb-3">
    <button id="btnReenviarSelecionados" 
        class="bg-orange-600 hover:bg-orange-700 text-white font-semibold py-1.5 px-3 rounded-md text-sm shadow-sm flex items-center">
        <i class="fas fa-paper-plane mr-1"></i> Reenviar Selecionados
    </button>
</div>

        <div class="table-responsive">
            <table class="min-w-full divide-y divide-gray-200">
                <thead class="bg-gradient-to-r from-gray-50 to-gray-100">
                    <tr>
                        <!-- Checkbox Selecionar Todos -->
                        <th class="py-4 px-6 text-center">
                            <input type="checkbox" id="selecionarTodosAvaliadores" class="form-checkbox h-4 w-4 text-blue-600">
                        </th>
                        <th class="py-4 px-6 text-left text-xs font-bold text-gray-700 uppercase tracking-wider">Nome</th>
                        <th class="py-4 px-6 text-left text-xs font-bold text-gray-700 uppercase tracking-wider">Email</th>
                        <th class="py-4 px-6 text-left text-xs font-bold text-gray-700 uppercase tracking-wider">PIN</th>
                        <th class="py-4 px-6 text-left text-xs font-bold text-gray-700 uppercase tracking-wider">Status</th>
                        <th class="py-4 px-6 text-left text-xs font-bold text-gray-700 uppercase tracking-wider">Projetos Atribuídos</th>
                        <th class="py-4 px-6 text-left text-xs font-bold text-gray-700 uppercase tracking-wider">Ações</th>
                        <th class="py-4 px-6 text-center text-xs font-bold text-gray-700 uppercase tracking-wider">QR Code</th>
                    </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200">
                    <% avaliadores.forEach(avaliador => { %>
                        <tr class="table-row-hover">
                            <!-- Checkbox individual -->
                            <td class="py-4 px-6 text-center">
                                <input type="checkbox" class="checkbox-avaliador form-checkbox h-4 w-4 text-blue-600"
                                    value="<%= avaliador._id %>">
                            </td>

                            <td class="py-4 px-6">
                                <div class="flex items-center">
                                    <div class="w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center mr-3">
                                        <span class="text-blue-600 font-semibold text-sm">
                                            <%= avaliador.nome.charAt(0).toUpperCase() %><%= avaliador.nome.split(' ')[1] ? avaliador.nome.split(' ')[1].charAt(0).toUpperCase() : '' %>
                                        </span>
                                    </div>
                                    <div>
                                        <div class="font-semibold text-blue-600 hover:underline cursor-pointer"
                                            onclick="abrirModalEdicaoAvaliador('<%= avaliador._id %>')"
                                            title="Clique para editar">
                                            <%= avaliador.nome %>
                                        </div>
                                    </div>
                                </div>
                            </td>

                            <td class="py-4 px-6"><div class="text-gray-900"><%= avaliador.email %></div></td>
                            <td class="py-4 px-6"><span class="font-mono text-sm bg-gray-100 px-3 py-1 rounded-lg"><%= avaliador.pin %></span></td>
                            <td class="py-4 px-6">
                                <span class="status-indicator <%= avaliador.ativo ? 'status-active' : 'status-inactive' %> px-3 py-1 rounded-full text-xs font-semibold
                                    <%= avaliador.ativo ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800' %>">
                                    <%= avaliador.ativo ? 'Ativo' : 'Inativo' %>
                                </span>
                            </td>
                            <td class="py-4 px-6">
                                <div class="flex flex-wrap gap-1">
                                    <% if (avaliador.projetosAtribuidos && avaliador.projetosAtribuidos.length > 0) { %>
                                        <% avaliador.projetosAtribuidos.forEach(projeto => { %>
                                            <span class="badge-animate inline-block bg-indigo-100 text-indigo-800 text-xs font-semibold px-2.5 py-0.5 rounded-full">
                                                <%= projeto.titulo %>
                                            </span>
                                        <% }) %>
                                    <% } else { %>
                                        <span class="text-gray-500 text-sm italic">Nenhum projeto</span>
                                    <% } %>
                                </div>
                            </td>
                            <td class="py-4 px-6 whitespace-nowrap">
                                <div class="flex flex-wrap gap-2">
                                    <!-- Botão Editar -->
                                    <button 
                                        class="tooltip btn-editar-avaliador btn-hover-effect bg-blue-600 hover:bg-blue-700 text-white font-semibold py-1.5 px-3 rounded-md text-sm shadow-sm" 
                                        data-tooltip="Editar avaliador"
                                        data-id="<%= avaliador._id || '' %>"
                                        data-nome="<%= avaliador.nome || '' %>"
                                        data-email="<%= avaliador.email || '' %>"
                                        data-pin="<%= avaliador.pin || '' %>"
                                        data-ativo="<%= avaliador.ativo ? 'true' : 'false' %>"
                                        data-projetos="<%= (avaliador.projetosAtribuidos && avaliador.projetosAtribuidos.length) 
                                            ? avaliador.projetosAtribuidos.map(p => p._id.toString()).join(',') 
                                            : '' %>"
                                        data-qrcode="<%= avaliador.qrcode || '' %>">
                                        <i class="fas fa-edit mr-1"></i>
                                        <span>Editar</span>
                                    </button>

                                    <!-- Botão Reenviar -->
                                    <button type="button" class="tooltip btn-reenviar-avaliador btn-hover-effect text-white font-semibold py-1.5 px-3 rounded-md text-sm shadow-sm" 
                                        style="background-color: #ea580c; border: none;" 
                                        onmouseover="this.style.backgroundColor='#c2410c'" 
                                        onmouseout="this.style.backgroundColor='#ea580c'"
                                        data-tooltip="Reenviar acesso"
                                        data-id="<%= avaliador._id %>"
                                        data-nome="<%= avaliador.nome %>"
                                        data-email="<%= avaliador.email %>">
                                        <i class="fas fa-paper-plane mr-1"></i>Reenviar
                                    </button>

                                    <!-- Botão Excluir -->
                                    <form action="/admin/avaliadores/<%= avaliador._id %>/excluir" method="POST" class="inline-block" onsubmit="return confirm('Tem certeza que deseja deletar este avaliador?');">
                                        <button type="submit" class="tooltip btn-hover-effect bg-red-600 hover:bg-red-700 text-white font-semibold py-1.5 px-3 rounded-md text-sm shadow-sm" 
                                            data-tooltip="Excluir avaliador">
                                            <i class="fas fa-trash-alt mr-1"></i>Excluir
                                        </button>
                                    </form>
                                </div>
                            </td>
                            <td class="py-4 px-6 text-center">
                                <div class="flex justify-center">
                                    <% if (avaliador.qrcode) { %>
                                        <img src="<%= avaliador.qrcode %>" alt="QR Code" class="h-12 w-12 rounded-lg shadow-sm border border-gray-200">
                                    <% } else { %>
                                        <div class="w-12 h-12 bg-gray-100 rounded-lg flex items-center justify-center border-2 border-dashed border-gray-300">
                                            <i class="fas fa-qrcode text-gray-400"></i>
                                        </div>
                                    <% } %>
                                </div>
                            </td>
                        </tr>
                    <% }) %>
                </tbody>
            </table>
        </div>
    </div>


        <!-- Conteúdo: Pré-Cadastros -->
        <div id="sub-pre-cadastros" class="subtab-content hidden">
            <%- include('partials/avaliadores-pre-cadastro', { preCadastros }) %>
        </div>

        <div id="sub-configurar-pre-cadastro" class="subtab-content hidden">
            <%- include('partials/configurar-formulario-pre-cadastro', { camposExtras }) %>
        </div>

        <!-- Modal melhorado -->
        <div id="modalReenviarAvaliador" class="fixed inset-0 modal-backdrop flex items-center justify-center z-50 hidden">
    <div class="modal-content bg-white p-6 rounded-xl w-full max-w-md shadow-2xl border border-gray-200 mx-4">
        <div class="flex items-center justify-between mb-4">
            <h3 class="text-xl font-bold text-gray-800" id="tituloModalReenviar">Reenviar Acesso ao Avaliador</h3>
            <button onclick="fecharModalReenviarAvaliador()" class="text-gray-400 hover:text-gray-600 transition-colors">
                <i class="fas fa-times text-lg"></i>
            </button>
        </div>
        
        <form id="formReenviarAvaliador" method="POST">
            <!-- Campo para mensagem -->
            <input type="hidden" name="mensagemPersonalizada" id="mensagemPersonalizada">
            <!-- Novo campo para IDs múltiplos -->
            <input type="hidden" name="idsSelecionados" id="idsSelecionados">

            <div class="mb-6">
                <label class="block text-sm font-semibold mb-2 text-gray-700">Mensagem Personalizada</label>
                <textarea id="campoMensagemAvaliador" 
                          class="w-full border border-gray-300 rounded-lg p-3 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors resize-none" 
                          rows="4" 
                          placeholder="Digite uma mensagem personalizada para o avaliador..."></textarea>
                <div class="text-xs text-gray-500 mt-1">Esta mensagem será incluída no email de acesso</div>
            </div>
            
            <div class="flex justify-end gap-3">
                <button type="button" 
                        onclick="fecharModalReenviarAvaliador()" 
                        class="px-4 py-2 text-gray-700 bg-gray-200 hover:bg-gray-300 rounded-lg transition-colors font-medium">
                    Cancelar
                </button>
                <button type="submit" 
                        class="text-white px-6 py-2 rounded-lg font-semibold shadow-sm"
                        style="background: linear-gradient(to right, #ea580c, #c2410c);"
                        onmouseover="this.style.background='linear-gradient(to right, #c2410c, #9a3412)'"
                        onmouseout="this.style.background='linear-gradient(to right, #ea580c, #c2410c)'">
                    <i class="fas fa-paper-plane mr-2"></i>Enviar
                </button>
            </div>
        </form>
    </div>
</div>

    <script>
    // Funcionalidades JavaScript
    document.addEventListener('DOMContentLoaded', function() {
        initializeSubtabs();
        initializeFilters();
        initializeAnimations();
        initializeEditarAvaliador();
    });

    function initializeSubtabs() {
        const subtabBtns = document.querySelectorAll('.subtab-btn');
        const subtabContents = document.querySelectorAll('.subtab-content');

        subtabBtns.forEach(btn => {
            btn.addEventListener('click', function () {
                const targetTab = this.dataset.subtab;

                subtabBtns.forEach(b => b.classList.remove('active'));
                this.classList.add('active');

                subtabContents.forEach(content => {
                    content.classList.add('hidden');
                    content.classList.remove('block', 'animate-fade-in');
                });

                const targetContent = document.getElementById(targetTab);
                if (targetContent) {
                    targetContent.classList.remove('hidden');
                    targetContent.classList.add('block', 'animate-fade-in');

                    // Reaplica os botões de editar após exibir a aba
                    if (targetTab === 'sub-avaliadores-cadastrados') {
                        initializeEditarAvaliador();
                    }
                }
            });
        });
    }

    function initializeFilters() {
        const searchInput = document.getElementById('searchInput');
        const statusFilter = document.getElementById('statusFilter');
        const tableRows = document.querySelectorAll('tbody tr');

        function filterTable() {
            const searchTerm = searchInput.value.toLowerCase();
            const statusValue = statusFilter.value;

            tableRows.forEach(row => {
                const nome = row.querySelector('td:nth-child(1)').textContent.toLowerCase();
                const email = row.querySelector('td:nth-child(2)').textContent.toLowerCase();
                const pin = row.querySelector('td:nth-child(3)').textContent.toLowerCase();
                const ativo = row.querySelector('td:nth-child(4) span').textContent.trim() === 'Ativo';

                const matchesSearch = nome.includes(searchTerm) || 
                                    email.includes(searchTerm) || 
                                    pin.includes(searchTerm);
                
                const matchesStatus = statusValue === '' || 
                                    (statusValue === 'true' && ativo) || 
                                    (statusValue === 'false' && !ativo);

                if (matchesSearch && matchesStatus) {
                    row.style.display = '';
                    row.classList.add('animate-fade-in');
                } else {
                    row.style.display = 'none';
                    row.classList.remove('animate-fade-in');
                }
            });
        }

        searchInput.addEventListener('input', filterTable);
        statusFilter.addEventListener('change', filterTable);
    }

    function limparFiltros() {
        document.getElementById('searchInput').value = '';
        document.getElementById('statusFilter').value = '';
        
        // Mostrar todas as linhas
        document.querySelectorAll('tbody tr').forEach(row => {
            row.style.display = '';
            row.classList.add('animate-fade-in');
        });
    }

    function initializeAnimations() {
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('animate-fade-in');
                }
            });
        });

        document.querySelectorAll('.table-row-hover').forEach(row => {
            observer.observe(row);
        });
    }

    function initializeEditarAvaliador() {
        document.querySelectorAll('.btn-editar-avaliador').forEach(button => {
            button.addEventListener('click', (event) => {
                const button = event.currentTarget;
                tituloAvaliador.textContent = 'Editar Avaliador';
                formAvaliador.action = `/admin/avaliadores/${button.dataset.id}?_method=PUT`;
                avaliadorId.value = button.dataset.id;
                inputNomeAvaliador.value = button.dataset.nome;
                inputEmailAvaliador.value = button.dataset.email;
                inputAtivoAvaliador.checked = button.dataset.ativo === 'true';
                avaliadorPinDisplay.textContent = button.dataset.pin;
                pinDisplayDiv.classList.remove('hidden');

                const projetosIds = button.dataset.projetos ? button.dataset.projetos.split(',') : [];
                projetosAvaliadorCheckboxesDiv.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
                    checkbox.checked = projetosIds.includes(checkbox.value);
                });

                const qrCodeUrl = button.dataset.qrcode || '';
                if (qrCodeUrl) {
                    document.getElementById('qrCodeImage').src = qrCodeUrl;
                    document.getElementById('qrCodePreview').classList.remove('hidden');
                } else {
                    document.getElementById('qrCodePreview').classList.add('hidden');
                }

                modalAvaliador.classList.remove('hidden');
                modalAvaliador.classList.add('flex');
            });
        });
    }

    // Fechar modal
function fecharModalReenviarAvaliador() {
    document.getElementById('modalReenviarAvaliador').classList.add('hidden');
}

// Reenvio individual (mantém o que você já tinha)
document.querySelectorAll('.btn-reenviar-avaliador').forEach(btn => {
    btn.addEventListener('click', function() {
        const modal = document.getElementById('modalReenviarAvaliador');
        const form = document.getElementById('formReenviarAvaliador');
        form.action = `/admin/avaliadores/${this.dataset.id}/reenviar`;
        document.getElementById('idsSelecionados')?.remove(); // remove campo extra se existir
        modal.classList.remove('hidden');
        document.getElementById('campoMensagemAvaliador').focus();
    });
});

// Reenvio múltiplo
document.getElementById('btnReenviarSelecionados')?.addEventListener('click', function() {
    const selecionados = [...document.querySelectorAll('.checkbox-avaliador:checked')].map(cb => cb.value);

    if (selecionados.length === 0) {
        alert('Selecione pelo menos um avaliador para reenviar.');
        return;
    }

    const modal = document.getElementById('modalReenviarAvaliador');
    const form = document.getElementById('formReenviarAvaliador');

    // Adiciona campo oculto com todos IDs
    let hiddenInput = document.getElementById('idsSelecionados');
    if (!hiddenInput) {
        hiddenInput = document.createElement('input');
        hiddenInput.type = 'hidden';
        hiddenInput.name = 'idsSelecionados';
        hiddenInput.id = 'idsSelecionados';
        form.appendChild(hiddenInput);
    }
    hiddenInput.value = selecionados.join(',');

    form.action = `/admin/avaliadores/reenviar-multiplos`;
    modal.classList.remove('hidden');
    document.getElementById('campoMensagemAvaliador').focus();
});

// Captura mensagem personalizada
document.getElementById('formReenviarAvaliador').addEventListener('submit', function(e) {
    const mensagem = document.getElementById('campoMensagemAvaliador').value;
    document.getElementById('mensagemPersonalizada').value = mensagem;
});

// Selecionar todos
document.getElementById('selecionarTodosAvaliadores')?.addEventListener('change', function() {
    document.querySelectorAll('.checkbox-avaliador').forEach(cb => cb.checked = this.checked);
});

</script>

<!-- FIM ABA: AVALIADORES -->

            <!-- ABA: FEIRAS -->
            <div class="tab-content p-6 bg-white rounded-lg shadow-inner border border-gray-200 hidden" id="feiras" role="tabpanel" aria-labelledby="feiras-tab">
                <button id="btnAbrirModalFeira" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-5 rounded-lg mb-6 shadow-md transition duration-300 ease-in-out">
                    <i class="fas fa-plus-circle mr-2"></i>Adicionar Nova Feira
                </button>

                <div class="overflow-x-auto bg-white rounded-lg shadow-md border border-gray-200">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-100">
                            <tr>
                                <th class="py-3 px-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Nome da Feira</th>
                                <th class="py-3 px-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Início</th>
                                <th class="py-3 px-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Término</th>
                                <th class="py-3 px-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Status</th>
                                <th class="py-3 px-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Ações</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200">
                            <% feiras.forEach(f => { %>
  <tr class="hover:bg-gray-100 transition duration-150 ease-in-out">
    <td class="py-3 px-4 text-gray-800"><%= f.nome %></td>
    <td class="py-3 px-4 text-gray-800"><%= f.inicioFeira ? formatarDatasParaInput(f.inicioFeira) : 'N/A' %></td>
    <td class="py-3 px-4 text-gray-800"><%= f.fimFeira ? formatarDatasParaInput(f.fimFeira) : 'N/A' %></td>
    <td class="py-3 px-4">
      <span class="px-2 py-1 rounded-full text-xs font-semibold
        <%= f.status === 'ativa' ? 'bg-green-100 text-green-800' : 'bg-orange-100 text-orange-800' %>">
        <%= f.status === 'ativa' ? 'Ativa' : 'Arquivada' %>
      </span>
    </td>
    <td class="py-3 px-4 whitespace-nowrap">
      <button class="btn-editar-feira bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-1.5 px-3 rounded-md text-sm mr-2 shadow-sm transition duration-300 ease-in-out"
        data-id="<%= f._id %>"
        data-nome="<%= f.nome %>"
        data-inicio="<%= f.inicioFeira ? formatarDatasParaInput(f.inicioFeira) : '' %>"
        data-fim="<%= f.fimFeira ? formatarDatasParaInput(f.fimFeira) : '' %>"
        data-status="<%= f.status %>">
        <i class="fas fa-edit mr-1"></i>Editar
      </button>

      <form method="POST" action="/admin/feiras/excluir" onsubmit="return confirm('Deseja realmente excluir esta feira?')" class="inline">
        <input type="hidden" name="feiraId" value="<%= f._id %>">
        <button type="submit" class="bg-red-600 hover:bg-red-700 text-white font-bold py-1.5 px-3 rounded-md text-sm shadow-sm transition duration-300 ease-in-out">
          <i class="fas fa-trash-alt mr-1"></i>Excluir
        </button>
      </form>
    </td>
  </tr>
<% }) %>

                        </tbody>
                    </table>
                </div>
            </div>
            <!-- FIM ABA: FEIRAS -->

            <!-- ABA DE RELATÓRIOS -->
           <div class="tab-content p-6 bg-white rounded-lg shadow-inner border border-gray-200 hidden" id="relatorios" role="tabpanel" aria-labelledby="relatorios-tab">
    <h3 class="text-2xl font-bold mb-5 text-gray-700">Relatórios Gerenciais</h3>
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        <a href="/admin/relatorio-consolidado/pdf" target="_blank" class="block p-6 bg-white rounded-lg shadow-md hover:shadow-lg transition duration-300 ease-in-out text-center">
            <i class="fas fa-file-invoice text-indigo-600 text-4xl mb-3"></i>
            <h4 class="text-lg font-semibold text-gray-800">Relatório Consolidado</h4>
            <p class="text-sm text-gray-600">Gera um relatório detalhado de projetos e avaliações.</p>
        </a>
        <a href="/admin/avaliacoes/pdf" target="_blank" class="block p-6 bg-white rounded-lg shadow-md hover:shadow-lg transition duration-300 ease-in-out text-center">
            <i class="fas fa-file-alt text-blue-600 text-4xl mb-3"></i>
            <h4 class="text-lg font-semibold text-gray-800">Avaliações Completas</h4>
            <p class="text-sm text-gray-600">Gera um PDF com detalhes de todas as avaliações.</p>
        </a>
        <a href="/admin/projetos-sem-avaliacao/pdf" target="_blank" class="block p-6 bg-white rounded-lg shadow-md hover:shadow-lg transition duration-300 ease-in-out text-center">
            <i class="fas fa-exclamation-triangle text-orange-600 text-4xl mb-3"></i>
            <h4 class="text-lg font-semibold text-gray-800">Projetos Sem Avaliação</h4>
            <p class="text-sm text-gray-600">Lista de projetos que ainda não foram avaliados.</p>
        </a>
        <a href="/admin/ranking-categorias/pdf" target="_blank" class="block p-6 bg-white rounded-lg shadow-md hover:shadow-lg transition duration-300 ease-in-out text-center">
            <i class="fas fa-trophy text-purple-600 text-4xl mb-3"></i>
            <h4 class="text-lg font-semibold text-gray-800">Ranking por Categoria</h4>
            <p class="text-sm text-gray-600">Classificação de projetos por categoria.</p>
        </a>
        <a href="/admin/resumo-avaliadores/pdf" target="_blank" class="block p-6 bg-white rounded-lg shadow-md hover:shadow-lg transition duration-300 ease-in-out text-center">
            <i class="fas fa-users text-green-600 text-4xl mb-3"></i>
            <h4 class="text-lg font-semibold text-gray-800">Resumo de Avaliadores</h4>
            <p class="text-sm text-gray-600">Status e atividades dos avaliadores.</p>
        </a>
        <a href="/admin/resultados-finais/pdf" target="_blank" class="block p-6 bg-white rounded-lg shadow-md hover:shadow-lg transition duration-300 ease-in-out text-center">
            <i class="fas fa-chart-bar text-red-600 text-4xl mb-3"></i>
            <h4 class="text-lg font-semibold text-gray-800">Resultados Finais</h4>
            <p class="text-sm text-gray-600">Relatório de resultados finais dos projetos.</p>
        </a>

        <a href="#" id="btnAbrirModalRelatorioOffline" class="block p-6 bg-white rounded-lg shadow-md hover:shadow-lg transition duration-300 ease-in-out text-center">
            <i class="fas fa-clipboard-list text-gray-600 text-4xl mb-3"></i> <h4 class="text-lg font-semibold text-gray-800">Relatório Avaliação Offline</h4>
            <p class="text-sm text-gray-600">Gera um relatório para avaliação manual (offline).</p>
        </a>

       <a href="/admin/relatorio/avaliadores/pdf/<%= feiraAtual._id %>" target="_blank" class="block p-6 bg-white rounded-lg shadow-md hover:shadow-lg transition duration-300 ease-in-out text-center">
  <i class="fas fa-id-card-alt text-teal-600 text-4xl mb-3"></i>
  <h4 class="text-lg font-semibold text-gray-800">Relatório de Avaliadores</h4>
  <p class="text-sm text-gray-600">Listagem completa com dados extras dos avaliadores.</p>
</a>

<a href="/admin/resumo-projetos/pdf" target="_blank" 
   class="relative block p-6 bg-white rounded-lg shadow-md hover:shadow-lg transition duration-300 ease-in-out text-center border border-pink-300">
    
    <!-- Badge de novidade com animação de piscar -->
    <span class="absolute top-2 right-2 bg-pink-600 text-white text-xs font-bold px-2 py-1 rounded-full shadow animate-blink">
        Novo
    </span>

    <i class="fas fa-user-check text-pink-600 text-4xl mb-3"></i>
    <h4 class="text-lg font-semibold text-gray-800">Avaliadores por Projeto</h4>
    <p class="text-sm text-gray-600">Verifica quantos avaliadores cada projeto possui.</p>
</a>

<style>
@keyframes blink {
  0%, 50%, 100% { opacity: 1; }
  25%, 75% { opacity: 0; }
}

.animate-blink {
  animation: blink 1.2s infinite;
}
</style>


    </div>
</div>
<div id="modalRelatorioOffline" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden flex items-center justify-center z-50">
    <div class="bg-white p-6 rounded-lg shadow-xl w-full max-w-md mx-4 sm:mx-0">
        <h3 class="text-lg font-semibold mb-4">Gerar Relatório de Avaliação Offline</h3>
        <div class="mb-4">
            <label for="selectFeiraRelatorio" class="block text-gray-700 text-sm font-bold mb-2">Selecione a Feira:</label>
            <select id="selectFeiraRelatorio" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
                <% feiras.forEach(feira => { %>
                    <option value="<%= feira._id %>" <%= feira.status === 'ativa' ? 'selected' : '' %>><%= feira.nome %></option>
                <% }); %>
            </select>
        </div>
        <div class="mb-6">
    <label class="block text-gray-700 text-sm font-bold mb-2">Selecione o(s) Avaliador(es):</label>

    <div class="mb-2">
        <label class="inline-flex items-center">
            <input type="checkbox" id="selecionarTodosAvaliadores" class="form-checkbox h-4 w-4 text-blue-600">
            <span class="ml-2 text-sm text-gray-700">Selecionar todos os avaliadores</span>
        </label>
    </div>

    <div id="avaliadoresCheckboxes" class="max-h-48 overflow-y-auto border border-gray-300 p-3 rounded-lg bg-gray-50 shadow-inner">
        <% if (avaliadores && avaliadores.length > 0) { %>
            <% avaliadores.forEach(avaliador => { %>
                <div class="flex items-center mb-2">
                    <input type="checkbox" id="avaliador_<%= avaliador._id %>" 
                           name="avaliadoresSelecionados" value="<%= avaliador._id %>" 
                           class="mr-2 h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
                    <label for="avaliador_<%= avaliador._id %>" class="text-gray-700 text-base">
                        <%= avaliador.nome %> (<%= avaliador.email %>)
                    </label>
                </div>
            <% }); %>
        <% } else { %>
            <p class="text-gray-500">Nenhum avaliador disponível.</p>
        <% } %>
    </div>
</div>
        <div class="flex flex-col sm:flex-row sm:justify-end gap-2 mt-4">
  <button id="btnGerarRelatorioOfflineConfirm" class="w-full sm:w-auto bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded">Gerar PDF</button>
  <button type="button" onclick="fecharModalRelatorioOffline()" class="w-full sm:w-auto bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded">Cancelar</button>
</div>

    </div>
</div>
            <!-- FIM DA ABA DE RELATÓRIOS -->

            <!-- ABA: CONFIGURAÇÕES -->
          <div class="tab-content p-6 bg-white rounded-lg shadow-inner border border-gray-200 hidden" id="tab-configuracoes" role="tabpanel" aria-labelledby="tab-configuracoes-tab">
  <h3 class="text-2xl font-bold mb-5 text-gray-700">Configurações da Escola</h3>

  <form action="/admin/escola/atualizar" method="POST" enctype="multipart/form-data" class="space-y-6">
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
      <div>
        <label for="nome" class="block text-sm font-medium text-gray-600">Nome da Escola</label>
        <input type="text" name="nome" id="nome" value="<%= escola.nome %>" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm px-3 py-2">
      </div>
      <div>
        <label for="telefone" class="block text-sm font-medium text-gray-600">Telefone</label>
        <input type="text" name="telefone" id="telefone" value="<%= escola.telefone %>" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm px-3 py-2">
      </div>
      <div>
        <label for="endereco" class="block text-sm font-medium text-gray-600">Endereço</label>
        <input type="text" name="endereco" id="endereco" value="<%= escola.endereco %>" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm px-3 py-2">
      </div>
      <div>
        <label for="logo" class="block text-sm font-medium text-gray-600">Logo da Escola (opcional)</label>
        <input type="file" name="logo" id="logo" accept="image/*" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm px-3 py-2">

        <% if (escola.logo) { %>
          <img src="<%= escola.logo %>" alt="Logo da escola" class="mt-2 max-h-20">
        <% } %>
      </div>
    </div>
    <div>
      <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">Salvar Alterações</button>
    </div>
  </form>
</div>
</form>

            <!-- FIM ABA: CONFIGURAÇÕES -->

            <!-- ABA MENSAGEM-->
          <div class="tab-content p-4 bg-white rounded-lg shadow-inner border border-gray-200 hidden max-w-4xl mx-auto" id="tab-suporte" role="tabpanel" aria-labelledby="tab-suporte-tab">
  <h2 class="text-xl font-bold text-gray-800 mb-3 flex items-center">
    <i class="fas fa-comments text-blue-600 mr-2 text-lg"></i>
    Tira-Dúvidas com Super ADM
  </h2>

  <!-- Formulário de envio -->
  <form action="/suporte" method="POST" class="mb-4">
    <textarea name="mensagem" rows="2" class="w-full p-2 text-sm rounded border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-400 resize-none" placeholder="Digite sua dúvida..." required></textarea>
    <button type="submit" class="mt-2 bg-blue-600 text-white px-3 py-1.5 text-sm rounded hover:bg-blue-700 transition">
      Enviar
    </button>
  </form>

  <!-- Lista de mensagens -->
  <div class="space-y-2 max-h-64 overflow-y-auto bg-gray-50 p-3 rounded border border-gray-200">
    <% if (mensagens && mensagens.length > 0) { %>
      <% mensagens.forEach(msg => { %>
        <div class="p-2 text-sm rounded 
          <%= msg.autorTipo === 'ADM' ? 'bg-blue-100 text-blue-900' : 'bg-green-100 text-green-900' %>">
          <div class="flex justify-between items-start mb-1">
            <strong class="text-xs font-semibold">
              <%= msg.autorTipo === 'ADM' ? 'Você' : 'Super ADM' %>
            </strong>
            <small class="text-xs text-gray-500 ml-2">
              <%= msg.dataEnvio ? new Date(msg.dataEnvio).toLocaleString('pt-BR', {
                day: '2-digit', month: '2-digit', hour: '2-digit', minute: '2-digit'
              }) : '' %>
            </small>
          </div>
          <p class="text-sm leading-relaxed whitespace-pre-line"><%= msg.mensagem %></p>
        </div>
      <% }) %>
    <% } else { %>
      <div class="bg-yellow-50 text-yellow-700 p-3 rounded text-sm text-center">
        Nenhuma mensagem enviada ainda.
      </div>
    <% } %>
  </div>
</div>
</div>

          <!-- FIM ABA: MENSAGEM -->

    <!-- Modals -->
    <div id="modalProjeto" class="fixed inset-0 bg-gray-900 bg-opacity-75 hidden justify-center items-center z-50 p-4">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-lg relative p-6 overflow-y-auto" style="max-height: 90vh;">
            <h2 id="tituloModalProjeto" class="text-3xl font-extrabold mb-6 text-center text-gray-800">Adicionar Novo Projeto</h2>
            <button id="btnFecharModalProjeto" class="absolute top-4 right-4 text-gray-500 hover:text-gray-800 text-4xl leading-none transition duration-300 ease-in-out">&times;</button>

            <form id="formProjeto" action="/admin/projetos" method="POST" enctype="multipart/form-data">
    <input type="hidden" id="projetoId" name="id">

    <div class="mb-4">
        <label for="titulo" class="block text-gray-700 text-sm font-bold mb-2">Título do Projeto:</label>
        <input type="text" id="titulo" name="titulo" class="shadow-sm appearance-none border border-gray-300 rounded-lg w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-150 ease-in-out" required>
    </div>

    <div class="mb-4">
        <label for="descricao" class="block text-gray-700 text-sm font-bold mb-2">Descrição:</label>
        <textarea style="max-height: 120px;" id="descricao" name="descricao" rows="3" class="shadow-sm appearance-none border border-gray-300 rounded-lg w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-150 ease-in-out"></textarea>
    </div>

    <div class="mb-4">
        <label for="categoria" class="block text-gray-700 text-sm font-bold mb-2">Categoria:</label>
        <select id="categoria" name="categoria" class="shadow-sm appearance-none border border-gray-300 rounded-lg w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-150 ease-in-out" required>
            <option value="">Selecione uma Categoria</option>
            <% categorias.forEach(cat => { %>
                <option value="<%= cat._id %>"><%= cat.nome %></option>
            <% }) %>
        </select>
    </div>

    <div class="mb-6">
        <label class="block text-gray-700 text-sm font-bold mb-2">Critérios de Avaliação:</label>
         <div class="mb-2">
                <label class="inline-flex items-center">
                    <input type="checkbox" id="selecionarTodosCriterios" class="form-checkbox h-4 w-4 text-blue-600">
                    <span class="ml-2 text-sm text-gray-700">Selecionar todos os critérios</span>
                </label>
            </div>
        <div id="criteriosProjetoCheckboxes" class="max-h-48 overflow-y-auto border border-gray-300 p-3 rounded-lg bg-gray-50 shadow-inner">

            <% if (criterios && criterios.length > 0) { %>
                <% criterios.forEach(criterio => { %>
                    <div class="flex items-center mb-2">
                        <input type="checkbox" id="criterio_<%= criterio._id %>" name="criterios" value="<%= criterio._id %>" class="mr-2 h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
                        <label for="criterio_<%= criterio._id %>" class="text-gray-700 text-base"><%= criterio.nome %> (Peso: <%= criterio.peso %>)</label>
                    </div>
                <% }) %>
            <% } else { %>
                <p class="text-gray-500">Nenhum critério disponível.</p>
            <% } %>
        </div>
    </div>

    <div class="mb-4">
        <label for="turmaProjeto" class="block text-gray-700 text-sm font-bold mb-2">Turma:</label>
        <input type="text" id="turmaProjeto" name="turma" class="shadow-sm appearance-none border border-gray-300 rounded-lg w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-150 ease-in-out" required>
    </div>

    <div class="mb-4">
        <label for="alunosTextArea" class="block text-gray-700 text-sm font-bold mb-2">Alunos (um por linha):</label>
        <textarea id="alunosTextArea" name="alunos" rows="4" class="shadow-sm appearance-none border border-gray-300 rounded-lg w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-150 ease-in-out"></textarea>
    </div>
    <div class="mb-4">
    <label for="orientador" class="block text-gray-700 text-sm font-bold mb-2">Professor Orientador:</label>
    <input type="text" id="orientador" name="orientador" class="shadow-sm appearance-none border border-gray-300 rounded-lg w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-150 ease-in-out">
</div>

<div class="mb-4">
    <label for="coorientador" class="block text-gray-700 text-sm font-bold mb-2">Professor Coorientador (opcional):</label>
    <input type="text" id="coorientador" name="coorientador" class="shadow-sm appearance-none border border-gray-300 rounded-lg w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-150 ease-in-out">
</div>

    <!-- NOVO CAMPO UPLOAD PDF -->
    <div class="mb-6">
    <label for="relatorioPdf" class="block text-gray-700 text-sm font-bold mb-2">Relatório (PDF):</label>
    <input type="file" id="relatorioPdf" name="relatorioPdf" accept="application/pdf" class="block w-full text-gray-700">
    <p class="text-xs text-gray-500 mt-1">Envie o relatório em formato PDF.</p>

    <!-- Link para PDF existente -->
<div id="pdfExistenteContainer" class="mt-2 hidden">
  <span class="text-sm font-semibold text-gray-700">Relatório atual: </span>
  <a id="linkRelatorioPdf" href="#" target="_blank" rel="noopener noreferrer" class="text-blue-600 hover:underline">
    Ver Relatório
  </a>
</div>
    <div class="flex items-center justify-end mt-6">
        <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2.5 px-5 rounded-lg focus:outline-none focus:shadow-outline shadow-md transition duration-300 ease-in-out">
            <i class="fas fa-save mr-2"></i>Salvar Projeto
        </button>
    </div>
</form>

        </div>
    </div>
</div>

    <div id="modalCategoria" class="fixed inset-0 bg-gray-900 bg-opacity-75 hidden justify-center items-center z-50 p-4">
        <div class="bg-white p-8 rounded-xl shadow-2xl w-full max-w-md relative">
            <h2 id="tituloModalCategoria" class="text-3xl font-extrabold mb-6 text-center text-gray-800">Adicionar Nova Categoria</h2>
            <button id="btnFecharModalCategoria" class="absolute top-4 right-4 text-gray-500 hover:text-gray-800 text-4xl leading-none transition duration-300 ease-in-out">&times;</button>
            <form id="formCategoria" action="/admin/categorias" method="POST">
                <input type="hidden" id="categoriaId" name="id">
                <div class="mb-4">
                    <label for="nomeCategoria" class="block text-gray-700 text-sm font-bold mb-2">Nome da Categoria:</label>
                    <input type="text" id="nomeCategoria" name="nome" class="shadow-sm appearance-none border border-gray-300 rounded-lg w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-150 ease-in-out" required>
                </div>
                <div class="flex items-center justify-end mt-6">
                    <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2.5 px-5 rounded-lg focus:outline-none focus:shadow-outline shadow-md transition duration-300 ease-in-out">
                        <i class="fas fa-save mr-2"></i>Salvar Categoria
                    </button>
                </div>
            </form>
        </div>
    </div>

    <div id="modalCriterio" class="fixed inset-0 bg-gray-900 bg-opacity-75 hidden justify-center items-center z-50 p-4">
        <div class="bg-white p-8 rounded-xl shadow-2xl w-full max-w-md relative">
            <h2 id="tituloModalCriterio" class="text-3xl font-extrabold mb-6 text-center text-gray-800">Adicionar Novo Critério</h2>
            <button id="btnFecharModalCriterio" class="absolute top-4 right-4 text-gray-500 hover:text-gray-800 text-4xl leading-none transition duration-300 ease-in-out">&times;</button>
            <form id="formCriterio" action="/admin/criterios" method="POST">
                <input type="hidden" id="criterioId" name="id">
                <div class="mb-4">
                    <label for="nomeCriterio" class="block text-gray-700 text-sm font-bold mb-2">Nome do Critério:</label>
                    <input type="text" id="nomeCriterio" name="nome" class="shadow-sm appearance-none border border-gray-300 rounded-lg w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-150 ease-in-out" required>
                </div>
                <div class="mb-4">
                    <label for="pesoCriterio" class="block text-gray-700 text-sm font-bold mb-2">Peso (1-10):</label>
                    <input type="number" id="pesoCriterio" name="peso" min="1" max="10" class="shadow-sm appearance-none border border-gray-300 rounded-lg w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-150 ease-in-out" required>
                </div>
                <div class="mb-4">
    <label for="ordemDesempateCriterio" class="block text-gray-700 text-sm font-bold mb-2">
        Ordem de Desempate (opcional):
    </label>
    <input type="number" id="ordemDesempateCriterio" name="ordemDesempate" min="0"
        class="shadow-sm appearance-none border border-gray-300 rounded-lg w-full py-2 px-3 text-gray-700 leading-tight
        focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-150 ease-in-out"
        placeholder="0 = Ignorar este critério no desempate">
    <p class="text-xs text-gray-500 mt-1">Quanto menor o número, maior a prioridade.<br>Use 0 para ignorar este critério no desempate.</p>
</div>

                <div class="mb-6">
                    <label for="observacaoCriterio" class="block text-gray-700 text-sm font-bold mb-2">Observações:</label>
                    <textarea id="observacaoCriterio" name="observacao" rows="3" class="shadow-sm appearance-none border border-gray-300 rounded-lg w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-150 ease-in-out"></textarea>
                </div>
                <div class="flex items-center justify-end gap-4 mt-6">
                    <button type="button" id="btnCancelarModalCriterio" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-2.5 px-5 rounded-lg focus:outline-none focus:shadow-outline shadow-md transition duration-300 ease-in-out">
                        <i class="fas fa-times-circle mr-2"></i>Cancelar
                    </button>
                    <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2.5 px-5 rounded-lg focus:outline-none focus:shadow-outline shadow-md transition duration-300 ease-in-out">
                        <i class="fas fa-save mr-2"></i>Salvar Critério
                    </button>
                </div>
            </form>
        </div>
    </div>

  <div id="modalAvaliador" class="fixed inset-0 bg-gray-900 bg-opacity-75 hidden justify-center items-center z-50 p-4">
  <div class="bg-white p-4 sm:p-6 rounded-lg shadow-xl w-full max-w-lg relative" style="max-height: 85vh; display: flex; flex-direction: column;">
    
    <!-- Cabeçalho fixo -->
    <div style="flex-shrink: 0;">
      <h2 id="tituloAvaliador" class="text-xl font-bold mb-4 text-center text-gray-800">Adicionar Novo Avaliador</h2>
      <button id="btnFecharAvaliador" class="absolute top-3 right-4 text-gray-500 hover:text-gray-800 text-3xl leading-none transition duration-300 ease-in-out">&times;</button>
    </div>

    <!-- Conteúdo com scroll -->
    <div style="flex: 1; overflow-y: auto; padding-right: 4px;">
      <form id="formAvaliador" action="/admin/avaliadores" method="POST">
            <input type="hidden" id="avaliadorId" name="id">
            <div class="mb-4">
                <label for="nomeAvaliador" class="block text-gray-700 text-sm font-bold mb-2">Nome do Avaliador:</label>
                <input type="text" id="nomeAvaliador" name="nome" class="shadow-sm appearance-none border border-gray-300 rounded-lg w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-150 ease-in-out" required>
            </div>
            <div class="mb-4">
                <label for="emailAvaliador" class="block text-gray-700 text-sm font-bold mb-2">Email:</label>
                <input type="email" id="emailAvaliador" name="email" class="shadow-sm appearance-none border border-gray-300 rounded-lg w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-150 ease-in-out" required>
            </div>

            <div class="mb-4" id="pinDisplayDiv">
                <label class="block text-gray-700 text-sm font-bold mb-2">PIN:</label>
                <span id="avaliadorPinDisplay" class="block bg-gray-100 p-3 rounded-lg text-xl font-mono tracking-wider text-gray-800 border border-gray-200"></span>
            </div>
            
            <div id="qrCodePreview" class="mb-4 hidden">
                <label class="block text-gray-700 text-sm font-bold mb-2">QR Code:</label>
                <div class="bg-gray-100 p-3 rounded-lg text-center border border-gray-200">
                    <img id="qrCodeImage" src="" alt="QR Code do Avaliador" class="mx-auto h-32">
                    <p class="text-xs text-gray-500 mt-2">Escaneie para acessar a tela de avaliação.</p>
                </div>
            </div>

            <div class="mb-4 flex items-center">
                <input type="checkbox" id="ativoAvaliador" name="ativo" class="mr-2 h-5 w-5 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
                <label for="ativoAvaliador" class="text-gray-700 text-base font-bold">Ativo</label>
            </div>
            
            <div class="mb-6">
                <label class="block text-gray-700 text-sm font-bold mb-2">Atribuir Projetos:</label>
                <div id="projetosAvaliadorCheckboxes" style="max-height: 150px; overflow-y: auto; border-radius: 0.375rem; border-color: #d1d5db;" class="border p-3 bg-gray-50 shadow-inner">
                    <% if (projetos && projetos.length > 0) { %>
                        <% projetos.forEach(projeto => { %>
                            <div class="flex items-center mb-2">
                                <input type="checkbox" id="projeto_<%= projeto._id %>" name="projetosAtribuidos" value="<%= projeto._id %>" 
                                    class="mr-2 h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
                                <label for="projeto_<%= projeto._id %>" class="text-gray-700 text-base"><%= projeto.titulo %></label>
                            </div>
                        <% }) %>
                    <% } else { %>
                        <p class="text-gray-500">Nenhum projeto disponível.</p>
                    <% } %>
                </div>
            </div>
        </form>
    </div>
    
    <!-- Rodapé fixo -->
    <div style="flex-shrink: 0; margin-top: 16px; padding-top: 16px; border-top: 1px solid #e5e7eb;">
        <div class="flex items-center justify-end">
            <button type="submit" form="formAvaliador" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2.5 px-5 rounded-lg focus:outline-none focus:shadow-outline shadow-md transition duration-300 ease-in-out">
                <i class="fas fa-save mr-2"></i>Salvar Avaliador
            </button>
        </div>
    </div>
    
  </div>
</div>

<!--fim modal pre-cadastro-->

    <!-- MODAL: Adicionar Nova Feira -->
<div id="modalFeira" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
  <form method="POST" action="/admin/feiras" class="bg-white rounded-lg shadow-lg p-6 w-full max-w-md space-y-4">
    <h2 id="tituloModalFeira" class="text-xl font-bold text-gray-700">Adicionar Nova Feira</h2>

    <input type="text" name="nome" id="nomeFeira" required placeholder="Nome da Feira"
      class="w-full border border-gray-300 p-2 rounded">

    <label for="inicioFeiraModal" class="block text-sm text-gray-600">Início da Feira</label>
    <input type="date" name="inicioFeira" id="inicioFeiraModal" required
      class="w-full border border-gray-300 p-2 rounded">

    <label for="fimFeiraModal" class="block text-sm text-gray-600">Fim da Feira</label>
    <input type="date" name="fimFeira" id="fimFeiraModal" required
      class="w-full border border-gray-300 p-2 rounded">

    <label for="statusFeiraModal" class="block text-sm text-gray-600">Status</label>
    <select name="status" id="statusFeiraModal" class="w-full border border-gray-300 p-2 rounded">
      <option value="ativa">Ativa</option>
      <option value="arquivada">Arquivada</option>
    </select>

    <div class="flex justify-end space-x-2 pt-2">
      <button type="button" onclick="fecharModalFeira()" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded">Cancelar</button>
      <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded">Salvar</button>
    </div>
  </form>
</div>

<!-- MODAL: Editar Feira -->
<div id="modalEditarFeira" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
  <form method="POST" action="/admin/feiras/editar" class="bg-white rounded-lg shadow-lg p-6 w-full max-w-md space-y-4">
    <h2 class="text-xl font-bold text-gray-700">Editar Feira</h2>

    <input type="hidden" name="feiraId" id="editarFeiraId">

    <label for="editarFeiraNome" class="block text-sm text-gray-600">Nome</label>
    <input type="text" name="nome" id="editarFeiraNome" required class="w-full border p-2 rounded" placeholder="Nome da Feira">

    <label for="editarInicioFeira" class="block text-sm text-gray-600">Início</label>
    <input type="date" name="inicioFeira" id="editarInicioFeira" required class="w-full border p-2 rounded">

    <label for="editarFimFeira" class="block text-sm text-gray-600">Fim</label>
    <input type="date" name="fimFeira" id="editarFimFeira" required class="w-full border p-2 rounded">

    <label for="editarFeiraStatus" class="block text-sm text-gray-600">Status</label>
    <select name="status" id="editarFeiraStatus" class="w-full border p-2 rounded">
      <option value="ativa">Ativa</option>
      <option value="arquivada">Arquivada</option>
    </select>

    <div class="flex justify-end items-center pt-4">
      <button type="button" onclick="fecharModalEditarFeira()" class="bg-gray-500 text-white px-4 py-2 rounded">Cancelar</button>
      <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded ml-2">Salvar</button>
    </div>
  </form>
</div>

<!-- FORM OCULTO: Exclusão de Feira -->
<form id="formExcluirFeira" action="/admin/feiras/excluir" method="POST" class="hidden">
  <input type="hidden" name="feiraId" id="excluirFeiraHidden">
</form>


      </div>
    </div>
  </form>
</div>
    
    <script>
document.addEventListener('DOMContentLoaded', () => {
    const sidebar = document.getElementById('sidebar');
    const sidebarToggle = document.getElementById('sidebarToggle');
    const sidebarIcon = sidebarToggle.querySelector('i');
    const contentArea = document.getElementById('contentArea');
    const tabLinks = document.querySelectorAll('.sidebar-link');
    const tabContents = document.querySelectorAll('.tab-content');
    const overlay = document.getElementById('overlay');

    // Função para ativar a aba
    const activateTab = (tabId) => {
        tabLinks.forEach(link => link.classList.remove('active'));
        tabContents.forEach(content => content.classList.add('hidden'));

        const activeLink = document.querySelector(`.sidebar-link[data-tab="${tabId}"]`);
        const activeContent = document.getElementById(tabId);

        if (activeLink) activeLink.classList.add('active');
        if (activeContent) activeContent.classList.remove('hidden');
    };

    // Abas + URL persistência
    const urlParams = new URLSearchParams(window.location.search);
    const initialTabFromUrl = urlParams.get('tab');
    const savedTab = localStorage.getItem('activeTab');
    const initialTab = initialTabFromUrl || savedTab || 'dashboard-geral';
    activateTab(initialTab);

    tabLinks.forEach(link => {
        link.addEventListener('click', (event) => {
            event.preventDefault();
            const tabId = link.dataset.tab;
            activateTab(tabId);
            localStorage.setItem('activeTab', tabId);
            const newUrl = new URL(window.location.href);
            newUrl.searchParams.set('tab', tabId);
            window.history.pushState({ path: newUrl.href }, '', newUrl.href);

            // Fecha o menu no mobile ao clicar em uma aba
            if (window.innerWidth <= 768) {
                closeSidebarMobile();
            }
        });
    });

    // Aplica estado do sidebar ao carregar
    const applySidebarState = () => {
        if (window.innerWidth <= 768) {
            sidebar.classList.remove('collapsed');
            sidebar.classList.remove('show');
            contentArea.style.marginLeft = '0px';
            resetHamburgerIcon();
        } else {
            const isCollapsed = localStorage.getItem('sidebarCollapsed') === 'true';
            if (isCollapsed) {
                sidebar.classList.add('collapsed');
                contentArea.style.marginLeft = '64px';
            } else {
                sidebar.classList.remove('collapsed');
                contentArea.style.marginLeft = '250px';
            }
            sidebar.classList.remove('show');
            resetHamburgerIcon();
        }
    };

    // Alterna sidebar no mobile
    const toggleSidebarMobile = () => {
        const isOpen = sidebar.classList.contains('show');
        if (isOpen) {
            closeSidebarMobile();
        } else {
            sidebar.classList.add('show');
            overlay.classList.add('active');
            if (sidebarIcon) {
                sidebarIcon.classList.remove('fa-bars');
                sidebarIcon.classList.add('fa-times');
            }
        }
    };

    const closeSidebarMobile = () => {
        sidebar.classList.remove('show');
        overlay.classList.remove('active');
        resetHamburgerIcon();
    };

    const resetHamburgerIcon = () => {
        if (sidebarIcon) {
            sidebarIcon.classList.remove('fa-times');
            sidebarIcon.classList.add('fa-bars');
        }
    };

    // Botão de abrir/fechar sidebar
    sidebarToggle.addEventListener('click', () => {
        if (window.innerWidth <= 768) {
            toggleSidebarMobile();
        } else {
            const isCurrentlyCollapsed = sidebar.classList.toggle('collapsed');
            localStorage.setItem('sidebarCollapsed', isCurrentlyCollapsed);
            contentArea.style.marginLeft = isCurrentlyCollapsed ? '64px' : '250px';
        }
    });

    // Overlay fecha o menu
    if (overlay) {
        overlay.addEventListener('click', () => {
            closeSidebarMobile();
        });
    }

    // Botão "X" se existir (opcional)
    const sidebarClose = document.getElementById('sidebarClose');
    if (sidebarClose) {
        sidebarClose.addEventListener('click', () => {
            closeSidebarMobile();
        });
    }

    // Responsivo ao redimensionamento
    window.addEventListener('resize', applySidebarState);
    applySidebarState();
    
                // Mostrar modal de Projeto
            const modalProjeto = document.getElementById('modalProjeto');
const btnAbrirModalProjeto = document.getElementById('btnAbrirModalProjeto');
const btnFecharModalProjeto = document.getElementById('btnFecharModalProjeto');
const formProjeto = document.getElementById('formProjeto');
const tituloModalProjeto = document.getElementById('tituloModalProjeto');
const projetoId = document.getElementById('projetoId');
const inputTitulo = document.getElementById('titulo');
const inputDescricao = document.getElementById('descricao');
const selectCategoria = document.getElementById('categoria');
const criteriosProjetoCheckboxesDiv = document.getElementById('criteriosProjetoCheckboxes');
const inputTurmaProjeto = document.getElementById('turmaProjeto');
const inputAlunos = document.getElementById('alunosTextArea');
const pdfExistenteContainer = document.getElementById('pdfExistenteContainer');
const linkRelatorioPdf = document.getElementById('linkRelatorioPdf');
const inputOrientador = document.getElementById('orientador');
const inputCoorientador = document.getElementById('coorientador');

// Abrir modal para adicionar novo projeto
btnAbrirModalProjeto.addEventListener('click', () => {
  tituloModalProjeto.textContent = 'Adicionar Novo Projeto';
  formProjeto.action = '/admin/projetos';
  projetoId.value = '';
  inputTitulo.value = '';
  inputDescricao.value = '';
  selectCategoria.value = '';
  inputTurmaProjeto.value = '';
  inputAlunos.value = '';

  // Limpar checkboxes
  criteriosProjetoCheckboxesDiv.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
    checkbox.checked = false;
  });

  // Esconder PDF anterior
  pdfExistenteContainer.classList.add('hidden');
  linkRelatorioPdf.href = '#';
  linkRelatorioPdf.textContent = '';

  modalProjeto.classList.remove('hidden');
  modalProjeto.classList.add('flex');
});

// Fechar modal
btnFecharModalProjeto.addEventListener('click', () => {
  modalProjeto.classList.remove('flex');
  modalProjeto.classList.add('hidden');
});

// Editar projeto
document.querySelectorAll('.btn-editar-projeto').forEach(button => {
  button.addEventListener('click', (event) => {
    const btn = event.currentTarget;

    tituloModalProjeto.textContent = 'Editar Projeto';
    formProjeto.action = `/admin/projetos/${btn.dataset.id}/editar`;
    projetoId.value = btn.dataset.id;
    inputTitulo.value = btn.dataset.titulo;
    inputDescricao.value = btn.dataset.descricao;
    selectCategoria.value = btn.dataset.categoriaId;
    inputTurmaProjeto.value = btn.dataset.turma;
    inputAlunos.value = btn.dataset.alunos ? btn.dataset.alunos.split(',').join('\n') : '';

    // Preencher orientador e coorientador
    inputOrientador.value = btn.dataset.orientador || '';
    inputCoorientador.value = btn.dataset.coorientador || '';

    const criteriosIds = btn.dataset.criterios ? btn.dataset.criterios.split(',') : [];
    criteriosProjetoCheckboxesDiv.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
      checkbox.checked = criteriosIds.includes(checkbox.value);
    });

    // Mostrar PDF se houver
    const pdfUrl = btn.dataset.relatorioPdf;
    if (pdfUrl && pdfUrl !== '#') {
      const visualizadorGoogle = `https://docs.google.com/viewer?url=${encodeURIComponent(pdfUrl)}&embedded=true`;
      linkRelatorioPdf.href = visualizadorGoogle;
      linkRelatorioPdf.textContent = "Ver Relatório";
      pdfExistenteContainer.classList.remove('hidden');
    } else {
      linkRelatorioPdf.href = '#';
      linkRelatorioPdf.textContent = "";
      pdfExistenteContainer.classList.add('hidden');
    }

    modalProjeto.classList.remove('hidden');
    modalProjeto.classList.add('flex');
  });
});

            // Mostrar modal de Categoria
            const modalCategoria = document.getElementById('modalCategoria');
            const btnAbrirModalCategoria = document.getElementById('btnAbrirModalCategoria');
            const btnFecharModalCategoria = document.getElementById('btnFecharModalCategoria');
            const formCategoria = document.getElementById('formCategoria');
            const tituloModalCategoria = document.getElementById('tituloModalCategoria');
            const categoriaId = document.getElementById('categoriaId');
            const inputNomeCategoria = document.getElementById('nomeCategoria');

            btnAbrirModalCategoria.addEventListener('click', () => {
                tituloModalCategoria.textContent = 'Adicionar Nova Categoria';
                formCategoria.action = '/admin/categorias'; 
                categoriaId.value = '';
                inputNomeCategoria.value = '';
                modalCategoria.classList.remove('hidden');
                modalCategoria.classList.add('flex');
            });

            btnFecharModalCategoria.addEventListener('click', () => {
                modalCategoria.classList.remove('flex');
                modalCategoria.classList.add('hidden');
            });

            document.querySelectorAll('.btn-editar-categoria').forEach(button => {
                button.addEventListener('click', (event) => {
                    tituloModalCategoria.textContent = 'Editar Categoria';
                    formCategoria.action = `/admin/categorias/${event.target.dataset.id}?_method=PUT`; 
                    categoriaId.value = event.target.dataset.id;
                    inputNomeCategoria.value = event.target.dataset.nome;
                    modalCategoria.classList.remove('hidden');
                    modalCategoria.classList.add('flex');
                });
            });

            // Mostrar modal de Critério
            const modalCriterio = document.getElementById('modalCriterio');
            const btnAbrirModalCriterio = document.getElementById('btnAbrirModalCriterio');
            const btnFecharModalCriterio = document.getElementById('btnFecharModalCriterio');
            const btnCancelarModalCriterio = document.getElementById('btnCancelarModalCriterio');
            const formCriterio = document.getElementById('formCriterio');
            const tituloModalCriterio = document.getElementById('tituloModalCriterio');
            const criterioId = document.getElementById('criterioId');
            const inputNomeCriterio = document.getElementById('nomeCriterio');
            const inputPesoCriterio = document.getElementById('pesoCriterio');
            const inputObservacaoCriterio = document.getElementById('observacaoCriterio');


            btnAbrirModalCriterio.addEventListener('click', () => {
                tituloModalCriterio.textContent = 'Adicionar Novo Critério';
                formCriterio.action = '/admin/criterios'; 
                criterioId.value = '';
                inputNomeCriterio.value = '';
                inputPesoCriterio.value = '';
                inputObservacaoCriterio.value = '';
                modalCriterio.classList.remove('hidden');
                modalCriterio.classList.add('flex');
            });

            btnFecharModalCriterio.addEventListener('click', () => {
                modalCriterio.classList.remove('flex');
                modalCriterio.classList.add('hidden');
            });

            btnCancelarModalCriterio.addEventListener('click', () => {
                modalCriterio.classList.remove('flex');
                modalCriterio.classList.add('hidden');
            });

            document.querySelectorAll('.btn-editar-criterio').forEach(button => {
                button.addEventListener('click', (event) => {
                    tituloModalCriterio.textContent = 'Editar Critério';
                    formCriterio.action = `/admin/criterios/${event.target.dataset.id}?_method=PUT`;
                    criterioId.value = event.target.dataset.id;
                    inputNomeCriterio.value = event.target.dataset.nome;
                    inputPesoCriterio.value = event.target.dataset.peso;
                    inputObservacaoCriterio.value = event.target.dataset.observacao;
                    document.getElementById('ordemDesempateCriterio').value = button.dataset.ordem || 0;
                    modalCriterio.classList.remove('hidden');
                    modalCriterio.classList.add('flex');
                });
            });

            // Mostrar modal de Avaliador
            const modalAvaliador = document.getElementById('modalAvaliador');
            const btnAbrirModalAvaliador = document.getElementById('btnAbrirModalAvaliador');
            const btnFecharAvaliador = document.getElementById('btnFecharAvaliador');
            const formAvaliador = document.getElementById('formAvaliador');
            const tituloAvaliador = document.getElementById('tituloAvaliador');
            const avaliadorId = document.getElementById('avaliadorId');
            const inputNomeAvaliador = document.getElementById('nomeAvaliador');
            const inputEmailAvaliador = document.getElementById('emailAvaliador');
            const inputAtivoAvaliador = document.getElementById('ativoAvaliador');
            const avaliadorPinDisplay = document.getElementById('avaliadorPinDisplay');
            const pinDisplayDiv = document.getElementById('pinDisplayDiv');
            const projetosAvaliadorCheckboxesDiv = document.getElementById('projetosAvaliadorCheckboxes');

            btnAbrirModalAvaliador.addEventListener('click', () => {
                tituloAvaliador.textContent = 'Adicionar Novo Avaliador';
                formAvaliador.action = '/admin/avaliadores';
                avaliadorId.value = '';
                inputNomeAvaliador.value = '';
                inputEmailAvaliador.value = '';
                inputAtivoAvaliador.checked = true;
                avaliadorPinDisplay.textContent = 'Gerado Automaticamente';
                pinDisplayDiv.classList.remove('hidden');

                // Limpar todos os checkboxes de projetos
                projetosAvaliadorCheckboxesDiv.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
                    checkbox.checked = false;
                });

                modalAvaliador.classList.remove('hidden');
                modalAvaliador.classList.add('flex');
            });

            btnFecharAvaliador.addEventListener('click', () => {
                modalAvaliador.classList.remove('flex');
                modalAvaliador.classList.add('hidden');
            });

         document.querySelectorAll('.btn-editar-avaliador').forEach(button => {
    button.addEventListener('click', (event) => {
        const btn = event.currentTarget; // garante que é o botão, não o ícone/span
        tituloAvaliador.textContent = 'Editar Avaliador';
        formAvaliador.action = `/admin/avaliadores/${btn.dataset.id}?_method=PUT`;
        avaliadorId.value = btn.dataset.id;
        inputNomeAvaliador.value = btn.dataset.nome || '';
        inputEmailAvaliador.value = btn.dataset.email || '';
        inputAtivoAvaliador.checked = btn.dataset.ativo === 'true';
        avaliadorPinDisplay.textContent = btn.dataset.pin || '';
        pinDisplayDiv.classList.remove('hidden');

        // Marcar checkboxes de projetos
        const projetosIds = btn.dataset.projetos ? btn.dataset.projetos.split(',') : [];
        projetosAvaliadorCheckboxesDiv.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
            checkbox.checked = projetosIds.includes(checkbox.value);
        });

        modalAvaliador.classList.remove('hidden');
        modalAvaliador.classList.add('flex');

        // Exibir o QR Code se existir
        const qrCodeUrl = btn.dataset.qrcode || '';
        if (qrCodeUrl) {
            document.getElementById('qrCodeImage').src = qrCodeUrl;
            document.getElementById('qrCodePreview').classList.remove('hidden');
        } else {
            document.getElementById('qrCodePreview').classList.add('hidden');
        }
    });
});

             // Script para alternar entre subtabs
  document.querySelectorAll('.subtab-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      document.querySelectorAll('.subtab-btn').forEach(b => b.classList.remove('active'));
      document.querySelectorAll('.subtab-content').forEach(c => c.classList.add('hidden'));

      btn.classList.add('active');
      document.getElementById(btn.dataset.subtab).classList.remove('hidden');
    });
  });

            // Mostrar modal de Feira
            const modalFeira = document.getElementById('modalFeira');
            const btnAbrirModalFeira = document.getElementById('btnAbrirModalFeira');
            const btnFecharModalFeira = document.getElementById('btnFecharModalFeira');
            const formFeira = document.getElementById('formFeira');
            const tituloModalFeira = document.getElementById('tituloModalFeira');
            const feiraId = document.getElementById('feiraId');
            const inputNomeFeira = document.getElementById('nomeFeira');
            const inputInicioFeiraModal = document.getElementById('inicioFeiraModal');
            const inputFimFeiraModal = document.getElementById('fimFeiraModal');
            const selectStatusFeiraModal = document.getElementById('statusFeiraModal');

            btnAbrirModalFeira.addEventListener('click', () => {
                tituloModalFeira.textContent = 'Adicionar Nova Feira';
                formFeira.action = '/admin/feiras'; 
                feiraId.value = '';
                inputNomeFeira.value = '';
                inputInicioFeiraModal.value = '';
                inputFimFeiraModal.value = '';
                selectStatusFeiraModal.value = 'ativa'; 
                modalFeira.classList.remove('hidden');
                modalFeira.classList.add('flex');
            });

            btnFecharModalFeira.addEventListener('click', () => {
                modalFeira.classList.remove('flex');
                modalFeira.classList.add('hidden');
            });

            // Mostrar modal de Configurações (apenas datas)
            const modalConfiguracoes = document.getElementById('modalConfiguracoes');
            const btnAbrirModalConfiguracoes = document.getElementById('btnAbrirModalConfiguracoes');
            const btnFecharModalConfiguracoes = document.getElementById('btnFecharModalConfiguracoes');

            btnAbrirModalConfiguracoes.addEventListener('click', () => {
                modalConfiguracoes.classList.remove('hidden');
                modalConfiguracoes.classList.add('flex');
            });

            btnFecharModalConfiguracoes.addEventListener('click', () => {
                modalConfiguracoes.classList.remove('flex');
                modalConfiguracoes.classList.add('hidden');
            });
        });

        // Função auxiliar para formatar datas
        function formatarDatasParaInput(dateString) {
            if (!dateString) return '';
            const date = new Date(dateString);
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${day}-${month}-${year}`;
        }

        document.getElementById('btnAbrirModalFeira').addEventListener('click', function () {
        document.getElementById('modalFeira').classList.remove('hidden');
        });
        function fecharModalFeira() {
        document.getElementById('modalFeira').classList.add('hidden');
        }

        //Abrir modal e preencher dados
  document.querySelectorAll('.btn-editar-feira').forEach(btn => {
    btn.addEventListener('click', () => {
      document.getElementById('editarFeiraId').value = btn.dataset.id;
      document.getElementById('editarFeiraNome').value = btn.dataset.nome;
      document.getElementById('editarInicioFeira').value = btn.dataset.inicio;
      document.getElementById('editarFimFeira').value = btn.dataset.fim;
      document.getElementById('modalEditarFeira').classList.remove('hidden');
    });
  });

  function fecharModalEditarFeira() {
    document.getElementById('modalEditarFeira').classList.add('hidden');
  }
  function confirmarExclusaoFeira() {
  if (confirm('Deseja realmente excluir esta feira?')) {
    document.getElementById('excluirFeiraHidden').value = document.getElementById('editarFeiraId').value;
    document.getElementById('formExcluirFeira').submit();
  }
}
  // Selecionar todos critérios (checkbox)
    document.getElementById('selecionarTodosCriterios')?.addEventListener('change', function () {
        const checkboxes = document.querySelectorAll('input[name="criterios"]');
        checkboxes.forEach(cb => cb.checked = this.checked);
    });

    // Lógica para o modal de Relatório Offline
const modalRelatorioOffline = document.getElementById('modalRelatorioOffline');
const btnAbrirModalRelatorioOffline = document.getElementById('btnAbrirModalRelatorioOffline');
const btnGerarRelatorioOfflineConfirm = document.getElementById('btnGerarRelatorioOfflineConfirm');
const selectFeiraRelatorio = document.getElementById('selectFeiraRelatorio');

// NOVAS CONSTANTES para os checkboxes de avaliadores
const selecionarTodosAvaliadoresCheckbox = document.getElementById('selecionarTodosAvaliadores');
const avaliadoresCheckboxesDiv = document.getElementById('avaliadoresCheckboxes');

// Abrir o modal
if (btnAbrirModalRelatorioOffline) {
    btnAbrirModalRelatorioOffline.addEventListener('click', (event) => {
        event.preventDefault();
        modalRelatorioOffline.classList.remove('hidden');
        modalRelatorioOffline.classList.add('flex');
    });
}

// Fechar o modal
function fecharModalRelatorioOffline() {
    modalRelatorioOffline.classList.remove('flex');
    modalRelatorioOffline.classList.add('hidden');
}

// "Selecionar todos os avaliadores"
if (selecionarTodosAvaliadoresCheckbox && avaliadoresCheckboxesDiv) {
    selecionarTodosAvaliadoresCheckbox.addEventListener('change', function () {
        const todosOsCheckboxesAvaliadores = avaliadoresCheckboxesDiv.querySelectorAll('input[type="checkbox"][name="avaliadoresSelecionados"]');
        const isChecked = this.checked;

        todosOsCheckboxesAvaliadores.forEach(checkbox => {
            checkbox.checked = isChecked;
        });
    });
}

// Gerar relatórios (um por avaliador selecionado)
if (btnGerarRelatorioOfflineConfirm) {
    btnGerarRelatorioOfflineConfirm.addEventListener('click', () => {
    const feiraId = selectFeiraRelatorio.value;

    const avaliadoresSelecionados = [];
    if (avaliadoresCheckboxesDiv) {
        avaliadoresCheckboxesDiv
            .querySelectorAll('input[type="checkbox"][name="avaliadoresSelecionados"]:checked')
            .forEach(checkbox => {
                avaliadoresSelecionados.push(checkbox.value);
            });
    }

    if (!feiraId || avaliadoresSelecionados.length === 0) {
        alert('Por favor, selecione uma feira e pelo menos um avaliador.');
        return;
    }

    btnGerarRelatorioOfflineConfirm.disabled = true;

    // Abrir cada aba de forma síncrona (dentro do clique)
    for (let i = 0; i < avaliadoresSelecionados.length; i++) {
        const avaliadorId = avaliadoresSelecionados[i];
        const url = `/admin/relatorio/avaliacao-offline/${feiraId}/${avaliadorId}`;

        const novaAba = window.open(url, '_blank');
        if (!novaAba) {
            console.warn(`A aba para o avaliador ${avaliadorId} foi bloqueada pelo navegador.`);
        }
    }

    setTimeout(() => {
        btnGerarRelatorioOfflineConfirm.disabled = false;
    }, 3000);

    fecharModalRelatorioOffline();
});

}

function copiarLinkPreCadastro() {
  const feiraId = '<%= feiraAtual?._id %>';
  if (!feiraId) {
    alert('⚠️ Nenhuma feira ativa no momento.');
    return;
  }

  const url = `${window.location.origin}/pre-cadastro/${feiraId}`;
  navigator.clipboard.writeText(url).then(() => {
    alert('🔗 Link copiado com sucesso:\n' + url);
  }).catch(err => {
    console.error('Erro ao copiar link:', err);
    alert('Erro ao copiar o link.');
  });
}

  let avaliadorIdSelecionado = '';

    // Abre o modal de Reenvio e configura a action do formulário
  document.querySelectorAll('.btn-reenviar-avaliador').forEach(button => {
    button.addEventListener('click', () => {
      const id = button.dataset.id;
      const modal = document.getElementById('modalReenviarAvaliador');
      const form = document.getElementById('formReenviarAvaliador');
      
      // Define a action correta do form
      form.action = `/admin/avaliadores/${id}/reenviar-email`;

      // Limpa o campo da mensagem
      document.getElementById('campoMensagemAvaliador').value = '';

      // Exibe o modal
      modal.classList.remove('hidden');
    });
  });

  // Fecha o modal
  function fecharModalReenviarAvaliador() {
    document.getElementById('modalReenviarAvaliador').classList.add('hidden');
  }

  // Ao enviar o formulário, passa a mensagem personalizada para o campo hidden
  document.getElementById('formReenviarAvaliador').addEventListener('submit', function(e) {
    const mensagem = document.getElementById('campoMensagemAvaliador').value.trim();
    document.getElementById('mensagemPersonalizada').value = mensagem;
  });

</script>

</body>
</html>
